CREATE OR REPLACE PROCEDURE DEV_DB.ENRICH.USP_LOAD_FACT_ACCOUNTING_DOCUMENT_LINES_ORA("TRIGGER_ID" VARCHAR(500), "BATCH_ID" NUMBER(38,0)	)
RETURNS NUMBER(38,0)
LANGUAGE SQL
EXECUTE AS OWNER
AS $$
    DECLARE 
	OBJECT_START_DATE TIMESTAMP_NTZ;
	OBJECT_END_DATE TIMESTAMP_NTZ;
	SOURCE_ROW_COUNT NUMBER;
	TARGET_ROW_COUNT NUMBER;
	SOURCE1 NUMBER;
	SOURCE2 NUMBER;
	SOURCE3 NUMBER;
	SOURCE4 NUMBER;
	SOURCE5 NUMBER;
	SOURCE6 NUMBER;
	SOURCE7 NUMBER;

	BEGIN
		OBJECT_START_DATE := CURRENT_TIMESTAMP();
       DELETE FROM ENRICH.FACT_ACCOUNTING_DOCUMENT_LINES WHERE SOURCE_ID = 2;
        
       INSERT INTO ENRICH.FACT_ACCOUNTING_DOCUMENT_LINES
			(TRX_SRC
			,COMPANY_CODE
			,CUSTOMER_CODE
			,IND_SPGL
			,CLEARING_DATE
			,CLEARING_DOC
			,AR_LINE_ASSIGNMENT
			,FISCAL_YEAR
			,DOCUMENT_NUMBER
			,POSTING_DATE
			,DOCUMENT_DATE
			,CURRENCY_KEY
			,REFERENCE_DOCUMENT_NUMBER
			,DOCUMENT_TYPE
			,POSTING_PERIOD
			,POSTING_KEY
			,TAX_CODE
			,AMOUNT_IN_LC
			,AMOUNT_IN_DC
			,LC_TAX
			,TAX_AMOUNT
			,INTERNAL_ORDER_CODE
			,MAIN_ASSET_NUMBER
			--,GL_ACCOUNT_NUMBER1
			,GL_ACCOUNT_NUMBER
			,TERMS_OF_PAYMENT_KEY
			--,DISCOUNT_AMT
			,CASH_DISCOUNT_IN_DC
			,PAYMENT_METHOD
			,HOUSE_BANK
			,PARTNER_BANK_TYPE
			,INVOICE_REF
			,TRADING_PARTNER
			,BILLING_DOCUMENT
			,INV_DUE_DATE
			,VAT_REG_NO
			,SALES_DOCUMENT
			,SALES_DOCUMENT_LINE
			--,DEBIT_CREDIT
			,BASELINE_DATE
			,DAYS_NET1
			,DAYS_NET2
			,DAYS_NET3
			,FOLLOW_ON_DOC
			,WBS_ELEMENT
			--,REFERENCE_KEY_1
			--,REF_KEY_2
			,GL_CURRENCY
			,GL_AMOUNT
			,COST_CENTER_CODE
			,CREDIT_CONTROL_AREA
			,PAYER
			,PROFIT_CENTER_CODE
			,REF_KEY_3
			,WHT_TAX_CODE
			--,PAYMENT_REF
			,PAYMENT_CURRENCY
			,PAYMENT_AMOUNT
			,NET_DUE_DATE
			,CUSTOMER_TRX_ID
			,CODE_COMBINATION_ID
			,TERM_ID
			,LEDGER_ID
			,PARTY_ID
			,PARTY_SITE_ID
			,CUSTOMER_TRX_LINE_ID
			,SALES_ORDER
			,SALES_ORDER_LINE
			,INVENTORY_ITEM_ID 
			,VENDOR_CODE --AP STARTED
			,AP_LINE_ASSIGNMENT 
			,IND_DRCR 
			,BUSINESS_AREA 
			,TAX_AMOUNT_LC 
			,TAX_AMOUNT_DC 
			,PURCHASING_DOC_NO 		
			,PAYMENT_TERM 
			,DISCOUNT_AMOUNT 
			,PAYMENT_BLOCK_KEY 
			,FIXED_PAYMENT_TERMS 
			,WHT_BASE_AMOUNT 
			,WHT_AMOUNT_DC 
			,PAYEE_PAYER_CODE 
			,PAYMENT_REFERENCE 
			,EXCHANGE_TYPE 
			,INVOICE_ID 
			,LINE_NUMBER_ID 
			,VENDOR_ID 
			,VENDOR_SITE_ID 
            ,DIST_CODE_COMBINATION_ID 
            ,SET_OF_BOOKS_ID 
			,SPGL_TRANSACTION_TYPE
			,PO_HEADER_ID
			,PO_LINE_ID
            ,ORG_ID
			
			,DOC_LINE_ITEM --GL STARTED
			,DOCLINE_ACC_TYPE
			,GL_CURRENCY_KEY
			,TAX_AMOUNT_2
			,LC_BASE_AMNT
			,INVOICE_BASE_AMOUNT
			,WHT_TAXBASE
			,VALUE_DATE
			,ACCOUNTING_DOC_LINE_ASSIGNMENT
			,DOC_LINE_TEXT
			,TRADING_PARTNER_CODE
			,TRANSACTION_TYPE
			,COST_CENTER_DESCRIPTION
			--,BILLING_DOC
			,SALES_DOCUMENT_NUMBER
			,SALES_DOCUMENT_ITEM
			,ASSET_SUBNUMBER
			,PERSONNEL_NO
			,INVOICE_BASELINE_DATE
			,CASH_DISCOUNT_AMOUNT
			,DISTRBUTN_TAXCODE
			--,AMOUNT_LC
			,AMOUNT_IN_FC
			,TAX_CODE_2
			,ADJUSTED_INVOICE_REFERENCE
			,ADJUSTED_INVOICE_FISCAL_YEAR
			,ADJUSTED_INVOICE_LINE_ITEM
			,WITHHOLDING_TAX
			,MATERIAL_NUMBER
			,PLANT_CODE
			,QUANTITY
			,BASE_UOM
			,PO_ITEM_NO
			,PROFIT_CENTER_NAME
			,PARTNER_CODE
			,CONTRACT_TYPE
			,CONTRACT_NUMBER
			,PROFIT_SEGMENT
			,PARTNER_PROFIT_CENTER
			,REFERENCE_KEY1
			,REFERENCE_KEY2
			,FUNCTIONAL_AREA
			,PAYMENT_TERM_DESC
			,PAYMENT_TERMS_DAYS1
			,PAYMENT_TERMS_DAYS2
			,PAYMENT_TERMS_DAYS3
			,DISCOUNT_PERCENT1
			,DISCOUNT_PERCENT2
			,PURCHASING_ORGANIZATION
			,JE_HEADER_ID
			,SOURCE_ID
			,START_DATE
			,END_DATE
			,IS_ACTIVE)
			
            

SELECT  
		Q1.TRX_SRC AS TRX_SRC,
		Q1.COMPANY_CODE AS COMPANY_CODE, --Q1.COMPANY_CODE AS COMPANY_CODE SET AS NULL BECAUSE GL_CODE_COMBINATIONS.SEGMENT1 IS NOT PRESENT
		Q1.CUSTOMER_CODE AS CUSTOMER_CODE,
		Q1.IND_SPGL AS IND_SPGL,
		Q1.CLEARING_DATE AS CLEARING_DATE,
		Q1.CLEARING_DOC AS CLEARING_DOC,
		NULL AS AR_LINE_ASSIGNMENT,
		Q1.FISCAL_YEAR AS FISCAL_YEAR,
		Q1.DOCUMENT_NUMBER AS DOCUMENT_NUMBER,
		Q1.POSTING_DATE AS POSTING_DATE,
		Q1.DOCUMENT_DATE AS DOCUMENT_DATE,
		Q1.CURRENCY_KEY AS CURRENCY_KEY,
		Q1.REFERENCE_DOCUMENT_NUMBER AS REFERENCE_DOCUMENT_NUMBER,
		Q1.DOCUMENT_TYPE AS DOCUMENT_TYPE,
		Q1.POSTING_PERIOD AS POSTING_PERIOD,
		Q1.POSTING_KEY AS POSTING_KEY,
		Q1.TAX_CODE AS TAX_CODE, --TO BE DERIVED IN RPT
		Q1.AMOUNT_IN_LC AS AMOUNT_IN_LC,
		Q1.AMOUNT_IN_DC AS AMOUNT_IN_DC,
		Q1.LC_TAX AS LC_TAX,
		NULL AS TAX_AMOUNT,
		NULL AS INTERNAL_ORDER_CODE,
		Q1.MAIN_ASSET_NUMBER AS MAIN_ASSET_NUMBER, 
		--Q1.GL_ACCOUNT_NUMBER1 AS GL_ACCOUNT_NUMBER1,   Q1.GL_ACCOUNT_NUMBER SET AS NULL DUE TO GL_CODE_COMBINATIONS.SEGMENT3 NOT PRESENT
		Q1.GL_ACCOUNT_NUMBER AS GL_ACCOUNT_NUMBER, --Q1.GL_ACCOUNT_NUMBER1 SET AS NULL DUE TO GL_CODE_COMBINATIONS.SEGMENT3 NOT PRESENT
		Q1.TERMS_OF_PAYMENT_KEY AS TERMS_OF_PAYMENT_KEY,
		--NULL AS DISCOUNT_AMT,
		Q1.CASH_DISCOUNT_IN_DC AS CASH_DISCOUNT_IN_DC, 
		Q1.PAYMENT_METHOD AS PAYMENT_METHOD,
		NULL AS HOUSE_BANK,
		Q1.PARTNER_BANK_TYPE AS PARTNER_BANK_TYPE,
		Q1.INVOICE_REF AS INVOICE_REF,
		NULL AS TRADING_PARTNER,
		Q1.BILLING_DOCUMENT AS BILLING_DOCUMENT,
		Q1.INV_DUE_DATE AS INV_DUE_DATE,
		Q1.VAT_REG_NO AS VAT_REG_NO,
		Q1.SALES_DOCUMENT AS SALES_DOCUMENT,
		NULL AS SALES_DOCUMENT_LINE,
		--Q1.DEBIT_CREDIT AS DEBIT_CREDIT,      TO BE DERIVED IN RPT
		Q1.BASELINE_DATE AS BASELINE_DATE,
		NULL AS DAYS_NET1,
		NULL AS DAYS_NET2,
		NULL AS DAYS_NET3,
		NULL AS FOLLOW_ON_DOC,
		NULL AS WBS_ELEMENT,
		--NULL AS REFERENCE_KEY_1,
		--NULL AS REF_KEY_2,
		Q1.GL_CURRENCY AS GL_CURRENCY,
		Q1.GL_AMOUNT AS GL_AMOUNT,
		Q1.COST_CENTER_CODE AS COST_CENTER_CODE, --Q1.COST_CENTER_CODE SET AS NULL AS GL_CODE_COMBINATIONS.SEGMENT2 NOT PRESENT
		NULL AS CREDIT_CONTROL_AREA,
		Q1.PAYER AS PAYER,
		Q1.PROFIT_CENTER_CODE AS PROFIT_CENTER_CODE,
		NULL AS REF_KEY_3,
		Q1.WHT_TAX_CODE AS WHT_TAX_CODE,
		--NULL AS PAYMENT_REF,
		Q1.PAYMENT_CURRENCY AS PAYMENT_CURRENCY,
		NULL AS PAYMENT_AMOUNT,
		NULL AS NET_DUE_DATE,
		Q1.CUSTOMER_TRX_ID AS CUSTOMER_TRX_ID,
		Q1.CODE_COMBINATION_ID AS CODE_COMBINATION_ID,
		Q1.TERM_ID AS TERM_ID,
		Q1.LEDGER_ID AS LEDGER_ID,
		Q1.PARTY_ID AS PARTY_ID,
		Q1.PARTY_SITE_ID AS PARTY_SITE_ID,
		Q1.CUSTOMER_TRX_LINE_ID AS CUSTOMER_TRX_LINE_ID,
		Q1.SALES_ORDER AS SALES_ORDER,
		Q1.SALES_ORDER_LINE AS SALES_ORDER_LINE,
		Q1.INVENTORY_ITEM_ID AS INVENTORY_ITEM_ID,
		
		Q1.VENDOR_CODE AS VENDOR_CODE,
		Q1.AP_LINE_ASSIGNMENT AS AP_LINE_ASSIGNMENT,
		Q1.IND_DRCR AS IND_DRCR,
		Q1.BUSINESS_AREA AS BUSINESS_AREA,
		Q1.TAX_AMOUNT_LC AS TAX_AMOUNT_LC,
		Q1.TAX_AMOUNT_DC AS TAX_AMOUNT_DC,
		Q1.PURCHASING_DOC_NO AS PURCHASING_DOC_NO,
		Q1.PAYMENT_TERM AS PAYMENT_TERM,
		Q1.DISCOUNT_AMOUNT AS DISCOUNT_AMOUNT,
		Q1.PAYMENT_BLOCK_KEY AS PAYMENT_BLOCK_KEY,
		Q1.FIXED_PAYMENT_TERMS AS FIXED_PAYMENT_TERMS,
		Q1.WHT_BASE_AMOUNT AS WHT_BASE_AMOUNT,
		Q1.WHT_AMOUNT_DC AS WHT_AMOUNT_DC,
		Q1.PAYEE_PAYER_CODE AS PAYEE_PAYER_CODE,
		Q1.PAYMENT_REFERENCE AS PAYMENT_REFERENCE,
		Q1.EXCHANGE_TYPE AS EXCHANGE_TYPE,
		Q1.INVOICE_ID AS INVOICE_ID,
		Q1.LINE_NUMBER_ID AS LINE_NUMBER_ID,
		Q1.VENDOR_ID AS VENDOR_ID,
		Q1.VENDOR_SITE_ID AS VENDOR_SITE_ID,
		Q1.DIST_CODE_COMBINATION_ID AS DIST_CODE_COMBINATION_ID,
		Q1.SET_OF_BOOKS_ID AS SET_OF_BOOKS_ID,
		Q1.SPGL_TRANSACTION_TYPE AS SPGL_TRANSACTION_TYPE,
		Q1.PO_HEADER_ID AS PO_HEADER_ID,
		Q1.PO_LINE_ID AS PO_LINE_ID,
		Q1.ORG_ID AS ORG_ID,
		
		Q1.DOC_LINE_ITEM AS DOC_LINE_ITEM,
		Q1.DOCLINE_ACC_TYPE AS DOCLINE_ACC_TYPE,
		Q1.GL_CURRENCY_KEY AS GL_CURRENCY_KEY,
		Q1.TAX_AMOUNT_2 AS TAX_AMOUNT_2,
		Q1.LC_BASE_AMNT AS LC_BASE_AMNT,
		Q1.INVOICE_BASE_AMOUNT AS INVOICE_BASE_AMOUNT,
		Q1.WHT_TAXBASE AS WHT_TAXBASE,
		Q1.VALUE_DATE AS VALUE_DATE,
		Q1.ACCOUNTING_DOC_LINE_ASSIGNMENT AS ACCOUNTING_DOC_LINE_ASSIGNMENT,
		Q1.DOC_LINE_TEXT AS DOC_LINE_TEXT,
		Q1.TRADING_PARTNER_CODE AS TRADING_PARTNER_CODE,
		Q1.TRANSACTION_TYPE AS TRANSACTION_TYPE,
		Q1.COST_CENTER_DESCRIPTION AS COST_CENTER_DESCRIPTION,
		--Q1.BILLING_DOC AS BILLING_DOC,
		Q1.SALES_DOCUMENT_NUMBER AS SALES_DOCUMENT_NUMBER,
		Q1.SALES_DOCUMENT_ITEM AS SALES_DOCUMENT_ITEM,
		Q1.ASSET_SUBNUMBER AS ASSET_SUBNUMBER,
		Q1.PERSONNEL_NO AS PERSONNEL_NO,
		Q1.INVOICE_BASELINE_DATE AS INVOICE_BASELINE_DATE,
		Q1.CASH_DISCOUNT_AMOUNT AS CASH_DISCOUNT_AMOUNT,
		Q1.DISTRBUTN_TAXCODE AS DISTRBUTN_TAXCODE,
		--Q1.AMOUNT_LC AS AMOUNT_LC,
		Q1.AMOUNT_IN_FC AS AMOUNT_IN_FC,
		Q1.TAX_CODE_2 AS TAX_CODE_2,
		Q1.ADJUSTED_INVOICE_REFERENCE AS ADJUSTED_INVOICE_REFERENCE,
		Q1.ADJUSTED_INVOICE_FISCAL_YEAR AS ADJUSTED_INVOICE_FISCAL_YEAR,
		Q1.ADJUSTED_INVOICE_LINE_ITEM AS ADJUSTED_INVOICE_LINE_ITEM,
		Q1.WITHHOLDING_TAX AS WITHHOLDING_TAX,
		Q1.MATERIAL_NUMBER AS MATERIAL_NUMBER,
		Q1.PLANT_CODE AS PLANT_CODE,
		Q1.QUANTITY AS QUANTITY,
		Q1.BASE_UOM AS BASE_UOM,
		Q1.PO_ITEM_NO AS PO_ITEM_NO,
		Q1.PROFIT_CENTER_NAME AS PROFIT_CENTER_NAME,
		Q1.PARTNER_CODE AS PARTNER_CODE,
		Q1.CONTRACT_TYPE AS CONTRACT_TYPE,
		Q1.CONTRACT_NUMBER AS CONTRACT_NUMBER,
		Q1.PROFIT_SEGMENT AS PROFIT_SEGMENT,
		Q1.PARTNER_PROFIT_CENTER AS PARTNER_PROFIT_CENTER,
		Q1.REFERENCE_KEY1 AS REFERENCE_KEY1,
		Q1.REFERENCE_KEY2 AS REFERENCE_KEY2,
		Q1.FUNCTIONAL_AREA AS FUNCTIONAL_AREA,
		Q1.PAYMENT_TERM_DESC AS PAYMENT_TERM_DESC,
		NULL AS PAYMENT_TERMS_DAYS1,
		NULL AS PAYMENT_TERMS_DAYS2,
		NULL AS PAYMENT_TERMS_DAYS3,
		Q1.DISCOUNT_PERCENT1 AS DISCOUNT_PERCENT1,
		Q1.DISCOUNT_PERCENT2 AS DISCOUNT_PERCENT2,
		Q1.PURCHASING_ORGANIZATION AS PURCHASING_ORGANIZATION,
		Q1.JE_HEADER_ID AS JE_HEADER_ID,
		
		2,
		CURRENT_DATE(),
		CURRENT_DATE(),
	    1
		
FROM(
SELECT  DISTINCT 'AR-TXN' AS TRX_SRC
	 ,NULL AS COMPANY_CODE--,GCC.SEGMENT1 AS COMPANY_CODE ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,HCA.ACCOUNT_NUMBER AS CUSTOMER_CODE
	 ,NULL AS IND_SPGL
	 ,(select MAX(apply_date) from raw_ora.ar_receivable_applications_all where APPLIED_CUSTOMER_TRX_ID = ACRA.CUSTOMER_TRX_ID) AS CLEARING_DATE
	 ,NULL AS CLEARING_DOC
	 ,YEAR(XAL.ACCOUNTING_DATE) AS FISCAL_YEAR
	 ,ACRA.TRX_NUMBER AS DOCUMENT_NUMBER
	 ,XAL.ACCOUNTING_DATE AS POSTING_DATE
	 ,ACRA.TRX_DATE AS DOCUMENT_DATE
	 ,ACRA.INVOICE_CURRENCY_CODE AS CURRENCY_KEY
	 ,ACRA.CT_REFERENCE AS REFERENCE_DOCUMENT_NUMBER
	 ,RCTTA.NAME AS DOCUMENT_TYPE
	 ,MONTH(XAL.ACCOUNTING_DATE) AS POSTING_PERIOD
	 ,XAL.ACCOUNTING_CLASS_CODE AS POSTING_KEY
	 ,NULL AS TAX_CODE
	 ,NVL(XDL.UNROUNDED_ACCOUNTED_DR,0)-NVL(XDL.UNROUNDED_ACCOUNTED_CR,0)AS AMOUNT_IN_LC
	 ,NVL(XDL.UNROUNDED_ENTERED_DR,0)-NVL(XDL.UNROUNDED_ENTERED_CR,0)AS AMOUNT_IN_DC
	 ,CASE WHEN ACCOUNTING_CLASS_CODE LIKE '%TAX%' THEN NVL(XDL.UNROUNDED_ACCOUNTED_DR,0)-NVL(XDL.UNROUNDED_ACCOUNTED_CR,0) ELSE NULL END AS LC_TAX
	 ,NULL AS MAIN_ASSET_NUMBER
	 --,NULL AS GL_ACCOUNT_NUMBER1, GCC.SEGMENT3 AS GL_ACCOUNT_NUMBER ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,NULL AS GL_ACCOUNT_NUMBER--,GCC.SEGMENT3 AS GL_ACCOUNT_NUMBER1 ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,RTT.NAME AS TERMS_OF_PAYMENT_KEY   
	 ,NULL AS CASH_DISCOUNT_IN_DC
	 ,NULL AS PAYMENT_METHOD
	 ,NULL AS PARTNER_BANK_TYPE
	 ,ACRA.TRX_NUMBER AS INVOICE_REF
	 ,ACRA.TRX_NUMBER AS BILLING_DOCUMENT
	 ,ACRA.TERM_DUE_DATE AS INV_DUE_DATE
	 ,HP.TAX_REFERENCE AS VAT_REG_NO
	 ,ACRL.SALES_ORDER AS SALES_DOCUMENT
	 --,CASE WHEN ((NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR ,0))>=0) THEN 'DR' ELSE 'CR' END AS DEBIT_CREDIT
	 ,ACRA.TERM_DUE_DATE AS BASELINE_DATE
	 ,GLL.CURRENCY_CODE AS GL_CURRENCY
	 ,NVL(XAL.ACCOUNTED_DR,0) - NVL(XAL.ACCOUNTED_CR,0) AS GL_AMOUNT
	 ,NULL AS COST_CENTER_CODE--,GCC.SEGMENT2 AS COST_CENTER_CODE ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,HCA.ACCOUNT_NUMBER AS PAYER
	 ,NULL AS PROFIT_CENTER_CODE
	 ,NULL AS WHT_TAX_CODE
	 ,ACRA.INVOICE_CURRENCY_CODE AS PAYMENT_CURRENCY
	 ,ACRA.CUSTOMER_TRX_ID AS CUSTOMER_TRX_ID
	 ,XAL.CODE_COMBINATION_ID AS CODE_COMBINATION_ID
	 ,RTT.TERM_ID AS TERM_ID
	 ,XAH.LEDGER_ID AS LEDGER_ID
	 ,XAL.PARTY_ID AS PARTY_ID
	 ,XAL.PARTY_SITE_ID AS PARTY_SITE_ID
	 ,ACRL.CUSTOMER_TRX_LINE_ID AS CUSTOMER_TRX_LINE_ID
	 ,ACRL.SALES_ORDER AS SALES_ORDER
	 ,ACRL.SALES_ORDER_LINE AS SALES_ORDER_LINE
	 ,ACRL.INVENTORY_ITEM_ID AS INVENTORY_ITEM_ID
	,NULL AS VENDOR_CODE
	,NULL AS AP_LINE_ASSIGNMENT
	,CASE WHEN ((NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR ,0))>=0) THEN 'DR' ELSE 'CR' END AS IND_DRCR
	,NULL AS BUSINESS_AREA
	,NULL AS TAX_AMOUNT_LC
	,NULL AS TAX_AMOUNT_DC
	,NULL AS PURCHASING_DOC_NO
	,NULL AS PAYMENT_TERM
	,NULL AS DISCOUNT_AMOUNT
	,NULL AS PAYMENT_BLOCK_KEY
	,NULL AS FIXED_PAYMENT_TERMS
	,NULL AS WHT_BASE_AMOUNT
	,NULL AS WHT_AMOUNT_DC
	,NULL AS PAYEE_PAYER_CODE
	,NULL AS PAYMENT_REFERENCE
	,NULL AS EXCHANGE_TYPE
	,NULL AS INVOICE_ID
	,NULL AS LINE_NUMBER_ID
	,NULL AS VENDOR_ID
	,NULL AS VENDOR_SITE_ID
	,NULL AS DIST_CODE_COMBINATION_ID
	,ACRA.SET_OF_BOOKS_ID AS SET_OF_BOOKS_ID
	,NULL AS SPGL_TRANSACTION_TYPE
	,NULL AS PO_HEADER_ID
	,NULL AS PO_LINE_ID
	,ACRA.ORG_ID AS ORG_ID,
	
	NULL AS DOC_LINE_ITEM,
			NULL AS DOCLINE_ACC_TYPE,
			NULL AS GL_CURRENCY_KEY,
			NULL AS TAX_AMOUNT_2,
			NULL AS LC_BASE_AMNT,
			NULL AS INVOICE_BASE_AMOUNT,
			NULL AS WHT_TAXBASE,
			NULL AS VALUE_DATE,
			NULL AS ACCOUNTING_DOC_LINE_ASSIGNMENT,
			NULL AS DOC_LINE_TEXT,
			NULL AS TRADING_PARTNER_CODE,
			NULL AS TRANSACTION_TYPE,
			NULL AS COST_CENTER_DESCRIPTION,
			--NULL AS BILLING_DOC,
			NULL AS SALES_DOCUMENT_NUMBER,
			NULL AS SALES_DOCUMENT_ITEM,
			NULL AS ASSET_SUBNUMBER,
			NULL AS PERSONNEL_NO,
			NULL AS INVOICE_BASELINE_DATE,
			NULL AS CASH_DISCOUNT_AMOUNT,
			NULL AS DISTRBUTN_TAXCODE,
			--NULL AS AMOUNT_LC,
			NULL AS AMOUNT_IN_FC,
			NULL AS TAX_CODE_2,
			NULL AS ADJUSTED_INVOICE_REFERENCE,
			NULL AS ADJUSTED_INVOICE_FISCAL_YEAR,
			NULL AS ADJUSTED_INVOICE_LINE_ITEM,
			NULL AS WITHHOLDING_TAX,
			NULL AS MATERIAL_NUMBER,
			NULL AS PLANT_CODE,
			NULL AS QUANTITY,
			NULL AS BASE_UOM,
			NULL AS PO_ITEM_NO,
			NULL AS PROFIT_CENTER_NAME,
			NULL AS PARTNER_CODE,
			NULL AS CONTRACT_TYPE,
			NULL AS CONTRACT_NUMBER,
			NULL AS PROFIT_SEGMENT,
			NULL AS PARTNER_PROFIT_CENTER,
			NULL AS REFERENCE_KEY1,
			NULL AS REFERENCE_KEY2,
			NULL AS FUNCTIONAL_AREA,
			NULL AS PAYMENT_TERM_DESC,
			NULL AS DISCOUNT_PERCENT1,
			NULL AS DISCOUNT_PERCENT2,
			NULL AS PURCHASING_ORGANIZATION,
			NULL AS JE_HEADER_ID
			--GJH.JE_HEADER_ID AS JE_HEADER_ID
	FROM RAW_ORA.GL_JE_HEADERS GJH  
		INNER JOIN  RAW_ORA.GL_JE_LINES GJL ON GJH.JE_HEADER_ID = GJL.JE_HEADER_ID
		            AND GJL.STATUS = 'P'
		INNER JOIN  RAW_ORA.GL_IMPORT_REFERENCES GIR ON GJL.JE_HEADER_ID = GIR.JE_HEADER_ID
					AND GJL.JE_LINE_NUM = GIR.JE_LINE_NUM
		INNER JOIN  RAW_ORA.XLA_AE_LINES XAL ON GIR.GL_SL_LINK_ID  = XAL.GL_SL_LINK_ID
					AND GIR.GL_SL_LINK_TABLE = XAL.GL_SL_LINK_TABLE
		INNER JOIN  RAW_ORA.XLA_AE_HEADERS XAH ON  XAL.APPLICATION_ID = XAH.APPLICATION_ID
					AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
		INNER JOIN	RAW_ORA.XLA_EVENTS XE ON XAH.APPLICATION_ID = XE.APPLICATION_ID
					AND XAH.EVENT_ID = XE.EVENT_ID
		INNER JOIN	RAW_ORA.XLA_TRANSACTION_ENTITIES XTE ON  XE.APPLICATION_ID = XTE.APPLICATION_ID
					AND XTE.APPLICATION_ID = 222
					AND XE.ENTITY_ID = XTE.ENTITY_ID
					AND XTE.ENTITY_CODE = 'TRANSACTIONS'
		INNER JOIN  RAW_ORA.XLA_DISTRIBUTION_LINKS XDL ON XAL.AE_HEADER_ID = XDL.AE_HEADER_ID
					AND XAL.AE_LINE_NUM = XDL.AE_LINE_NUM
		INNER JOIN 	RAW_ORA.RA_CUSTOMER_TRX_ALL ACRA ON XTE.SOURCE_ID_INT_1 = ACRA.CUSTOMER_TRX_ID
		INNER JOIN  RAW_ORA.RA_CUST_TRX_LINE_GL_DIST_ALL RGDA ON ACRA.CUSTOMER_TRX_ID = RGDA.CUSTOMER_TRX_ID
					AND XDL.SOURCE_DISTRIBUTION_ID_NUM_1 = RGDA.CUST_TRX_LINE_GL_DIST_ID
		LEFT JOIN   RAW_ORA.RA_CUSTOMER_TRX_LINES_ALL ACRL ON ACRA.CUSTOMER_TRX_ID = ACRL.CUSTOMER_TRX_ID
					AND NVL(RGDA.CUSTOMER_TRX_LINE_ID,0) = NVL(ACRL.CUSTOMER_TRX_LINE_ID,0)
--				AND ACRL.LINE_TYPE = 'LINE'
		LEFT JOIN   RAW_ORA.HZ_CUST_ACCOUNTS HCA ON ACRA.BILL_TO_CUSTOMER_ID = HCA.CUST_ACCOUNT_ID
		LEFT JOIN   RAW_ORA.HZ_PARTIES HP ON HCA.PARTY_ID = HP.PARTY_ID
		LEFT JOIN   RAW_ORA.RA_CUST_TRX_TYPES_ALL RCTTA ON ACRA.CUST_TRX_TYPE_ID = RCTTA.CUST_TRX_TYPE_ID
					AND RCTTA.ORG_ID = ACRA.ORG_ID
		LEFT JOIN   RAW_ORA.MTL_SYSTEM_ITEMS_B MSIB ON ACRL.INVENTORY_ITEM_ID = MSIB.INVENTORY_ITEM_ID
					AND MSIB.ORGANIZATION_ID = ACRA.ORG_ID
		LEFT JOIN   RAW_ORA.RA_TERMS_TL RTT ON  RTT.TERM_ID = ACRA.TERM_ID
		LEFT JOIN   RAW_ORA.GL_LEDGERS GLL ON GLL.LEDGER_ID = GJL.LEDGER_ID
					AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY'
		WHERE   GJH.JE_SOURCE = 'Receivables' 
		
UNION ALL
   
SELECT  DISTINCT 'AR-RCPT' AS TRX_SRC
	 ,NULL AS COMPANY_CODE--,GCC.SEGMENT1 AS COMPANY_CODE ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,HCA.ACCOUNT_NUMBER AS CUSTOMER_CODE
	 ,NULL AS IND_SPGL
	 ,NULL AS CLEARING_DATE
	 ,NULL AS CLEARING_DOC
	 ,YEAR(XAL.ACCOUNTING_DATE) AS FISCAL_YEAR
	 ,ACRA.RECEIPT_NUMBER AS DOCUMENT_NUMBER
	 ,XAL.ACCOUNTING_DATE AS POSTING_DATE
	 ,NULL AS DOCUMENT_DATE
	 ,NULL AS CURRENCY_KEY
	 ,NULL AS REFERENCE_DOCUMENT_NUMBER
	 ,ARC.NAME AS DOCUMENT_TYPE
	 ,MONTH(XAL.ACCOUNTING_DATE) AS POSTING_PERIOD
	 ,XAL.ACCOUNTING_CLASS_CODE AS POSTING_KEY
	 ,NULL AS TAX_CODE
	 ,CASE WHEN ACCOUNTING_CLASS_CODE LIKE '%ITEM%' THEN NVL(XAL.ACCOUNTED_DR,0) - NVL(XAL.ACCOUNTED_CR,0) ELSE NULL END AS AMOUNT_IN_LC
	 ,CASE WHEN ACCOUNTING_CLASS_CODE LIKE '%ITEM%' THEN NVL(XAL.ENTERED_DR,0) - NVL(XAL.ENTERED_CR,0) ELSE NULL END AS AMOUNT_IN_DC
	 ,CASE WHEN ACCOUNTING_CLASS_CODE LIKE '%TAX%' THEN NVL(XAL.ACCOUNTED_DR,0) - NVL(XAL.ACCOUNTED_CR,0) ELSE NULL END AS LC_TAX
	 ,NULL AS MAIN_ASSET_NUMBER
	 --,NULL AS GL_ACCOUNT_NUMBER1  ,GCC.SEGMENT3 AS GL_ACCOUNT_NUMBER ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,NULL AS GL_ACCOUNT_NUMBER--,GCC.SEGMENT3 AS GL_ACCOUNT_NUMBER1, GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,NULL AS TERMS_OF_PAYMENT_KEY
	 ,NULL AS CASH_DISCOUNT_IN_DC
	 ,NULL AS PAYMENT_METHOD
	 ,NULL AS PARTNER_BANK_TYPE
	 ,NULL AS INVOICE_REF
	 ,NULL AS BILLING_DOCUMENT
	 ,NULL AS INV_DUE_DATE
	 ,HP.TAX_REFERENCE AS VAT_REG_NO
	 ,NULL AS SALES_DOCUMENT
	 --,CASE WHEN ((NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR ,0))>=0) THEN 'DR' ELSE 'CR' END AS DEBIT_CREDIT
	 ,NULL AS BASELINE_DATE
	 ,GLL.CURRENCY_CODE AS GL_CURRENCY --GL_LEDGERS.CURRENCY_CODE NOT AVAILABLE
	 ,NVL(XAL.ACCOUNTED_DR,0) - NVL(XAL.ACCOUNTED_CR,0) AS GL_AMOUNT
	 ,NULL AS COST_CENTER_CODE--,GCC.SEGMENT2 AS COST_CENTER_CODE ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,HCA.ACCOUNT_NUMBER AS PAYER
	 ,NULL AS PROFIT_CENTER_CODE
	 ,NULL AS WHT_TAX_CODE
	 ,ACRA.CURRENCY_CODE AS PAYMENT_CURRENCY
	 ,NULL AS CUSTOMER_TRX_ID
	 ,XAL.CODE_COMBINATION_ID AS CODE_COMBINATION_ID
	 ,NULL AS TERM_ID
	 ,XAH.LEDGER_ID AS LEDGER_ID
	 ,XAL.PARTY_ID AS PARTY_ID
	 ,XAL.PARTY_SITE_ID AS PARTY_SITE_ID
	 ,NULL AS CUSTOMER_TRX_LINE_ID
	 ,NULL AS SALES_ORDER
	 ,NULL AS SALES_ORDER_LINE
	 ,NULL AS INVENTORY_ITEM_ID
	 
	,NULL AS VENDOR_CODE
	,NULL AS AP_LINE_ASSIGNMENT
	,CASE WHEN ((NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR ,0))>=0) THEN 'DR' ELSE 'CR' END AS IND_DRCR
	,NULL AS BUSINESS_AREA
	,NULL AS TAX_AMOUNT_LC
	,NULL AS TAX_AMOUNT_DC
	,NULL AS PURCHASING_DOC_NO
	,NULL AS PAYMENT_TERM
	,NULL AS DISCOUNT_AMOUNT
	,NULL AS PAYMENT_BLOCK_KEY
	,NULL AS FIXED_PAYMENT_TERMS
	,NULL AS WHT_BASE_AMOUNT
	,NULL AS WHT_AMOUNT_DC
	,NULL AS PAYEE_PAYER_CODE
	,NULL AS PAYMENT_REFERENCE
	,NULL AS EXCHANGE_TYPE
	,NULL AS INVOICE_ID
	,NULL AS LINE_NUMBER_ID
	,NULL AS VENDOR_ID
	,NULL AS VENDOR_SITE_ID
	,NULL AS DIST_CODE_COMBINATION_ID
	,NULL AS SET_OF_BOOKS_ID
	,NULL AS SPGL_TRANSACTION_TYPE
	,NULL AS PO_HEADER_ID
	,NULL AS PO_LINE_ID
	,NULL AS ORG_ID,
	
	NULL AS DOC_LINE_ITEM,
			NULL AS DOCLINE_ACC_TYPE,
			NULL AS GL_CURRENCY_KEY,
			NULL AS TAX_AMOUNT_2,
			NULL AS LC_BASE_AMNT,
			NULL AS INVOICE_BASE_AMOUNT,
			NULL AS WHT_TAXBASE,
			NULL AS VALUE_DATE,
			NULL AS ACCOUNTING_DOC_LINE_ASSIGNMENT,
			NULL AS DOC_LINE_TEXT,
			NULL AS TRADING_PARTNER_CODE,
			NULL AS TRANSACTION_TYPE,
			NULL AS COST_CENTER_DESCRIPTION,
			--NULL AS BILLING_DOC,
			NULL AS SALES_DOCUMENT_NUMBER,
			NULL AS SALES_DOCUMENT_ITEM,
			NULL AS ASSET_SUBNUMBER,
			NULL AS PERSONNEL_NO,
			NULL AS INVOICE_BASELINE_DATE,
			NULL AS CASH_DISCOUNT_AMOUNT,
			NULL AS DISTRBUTN_TAXCODE,
			--NULL AS AMOUNT_LC,
			NULL AS AMOUNT_IN_FC,
			NULL AS TAX_CODE_2,
			NULL AS ADJUSTED_INVOICE_REFERENCE,
			NULL AS ADJUSTED_INVOICE_FISCAL_YEAR,
			NULL AS ADJUSTED_INVOICE_LINE_ITEM,
			NULL AS WITHHOLDING_TAX,
			NULL AS MATERIAL_NUMBER,
			NULL AS PLANT_CODE,
			NULL AS QUANTITY,
			NULL AS BASE_UOM,
			NULL AS PO_ITEM_NO,
			NULL AS PROFIT_CENTER_NAME,
			NULL AS PARTNER_CODE,
			NULL AS CONTRACT_TYPE,
			NULL AS CONTRACT_NUMBER,
			NULL AS PROFIT_SEGMENT,
			NULL AS PARTNER_PROFIT_CENTER,
			NULL AS REFERENCE_KEY1,
			NULL AS REFERENCE_KEY2,
			NULL AS FUNCTIONAL_AREA,
			NULL AS PAYMENT_TERM_DESC,
			NULL AS DISCOUNT_PERCENT1,
			NULL AS DISCOUNT_PERCENT2,
			NULL AS PURCHASING_ORGANIZATION,
			NULL AS JE_HEADER_ID
			--GJH.JE_HEADER_ID AS JE_HEADER_ID

	FROM RAW_ORA.GL_JE_HEADERS GJH 
		INNER JOIN  RAW_ORA.GL_JE_LINES GJL ON GJH.JE_HEADER_ID = GJL.JE_HEADER_ID 
					AND GJL.STATUS = 'P'
		INNER JOIN  RAW_ORA.GL_IMPORT_REFERENCES GIR ON GJL.JE_HEADER_ID = GIR.JE_HEADER_ID 
					AND GJL.JE_LINE_NUM = GIR.JE_LINE_NUM
		INNER JOIN  RAW_ORA.XLA_AE_LINES XAL ON GIR.GL_SL_LINK_ID  = XAL.GL_SL_LINK_ID 
					AND GIR.GL_SL_LINK_TABLE = XAL.GL_SL_LINK_TABLE
		INNER JOIN  RAW_ORA.XLA_AE_HEADERS XAH ON  XAL.APPLICATION_ID = XAH.APPLICATION_ID 
					AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
		INNER JOIN	RAW_ORA.XLA_EVENTS XE ON XAH.APPLICATION_ID = XE.APPLICATION_ID 
					AND XAH.EVENT_ID = XE.EVENT_ID
		INNER JOIN	RAW_ORA.XLA_TRANSACTION_ENTITIES XTE ON  XE.APPLICATION_ID = XTE.APPLICATION_ID 
					AND XTE.APPLICATION_ID = 222 
					AND XE.ENTITY_ID = XTE.ENTITY_ID 
					AND XTE.ENTITY_CODE = 'RECEIPTS'
		INNER JOIN 	RAW_ORA.AR_CASH_RECEIPTS_ALL ACRA ON XTE.SOURCE_ID_INT_1 = ACRA.CASH_RECEIPT_ID
		LEFT JOIN   RAW_ORA.HZ_CUST_ACCOUNTS HCA ON ACRA.PAY_FROM_CUSTOMER =   HCA.CUST_ACCOUNT_ID
		LEFT JOIN   RAW_ORA.HZ_PARTIES HP ON HCA.PARTY_ID = HP.PARTY_ID
		INNER JOIN RAW_ORA.GL_LEDGERS GLL ON GLL.LEDGER_ID = XAL.LEDGER_ID 
					AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY'
		LEFT JOIN RAW_ORA.AR_RECEIPT_CLASSES ARC ON ARC.RECEIPT_CLASS_ID = ACRA.RECEIPT_METHOD_ID
		WHERE GJH.JE_SOURCE = 'Receivables'
					
UNION ALL
 
SELECT  DISTINCT 'AR-ADJ' AS TRX_SRC
	 ,NULL AS COMPANY_CODE--GCC.SEGMENT1 AS COMPANY_CODE ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,HCA.ACCOUNT_NUMBER AS CUSTOMER_CODE
	 ,NULL AS IND_SPGL
	 ,NULL AS CLEARING_DATE
	 ,NULL AS CLEARING_DOC
	 ,YEAR(XAL.ACCOUNTING_DATE) AS FISCAL_YEAR
	 ,TO_VARCHAR(ACRA.ADJUSTMENT_ID) AS DOCUMENT_NUMBER
	 ,XAL.ACCOUNTING_DATE AS POSTING_DATE
	 ,NULL AS DOCUMENT_DATE
	 ,NULL AS CURRENCY_KEY
	 ,NULL AS REFERENCE_DOCUMENT_NUMBER
	 ,AL.MEANING AS DOCUMENT_TYPE 
	 ,MONTH(XAL.ACCOUNTING_DATE) AS POSTING_PERIOD
	 ,XAL.ACCOUNTING_CLASS_CODE AS POSTING_KEY
	 ,NULL AS TAX_CODE
	 ,CASE WHEN ACCOUNTING_CLASS_CODE LIKE '%ITEM%' THEN NVL(XAL.ACCOUNTED_DR,0) - NVL(XAL.ACCOUNTED_CR,0) ELSE NULL END AS AMOUNT_IN_LC
	 ,CASE WHEN ACCOUNTING_CLASS_CODE LIKE '%ITEM%' THEN NVL(XAL.ENTERED_DR,0) - NVL(XAL.ENTERED_CR,0) ELSE NULL END AS AMOUNT_IN_DC
	 ,CASE WHEN ACCOUNTING_CLASS_CODE LIKE '%TAX%' THEN NVL(XAL.ACCOUNTED_DR,0) - NVL(XAL.ACCOUNTED_CR,0) ELSE NULL END AS LC_TAX
	 ,NULL AS MAIN_ASSET_NUMBER
	 --,NULL AS GL_ACCOUNT_NUMBER1--,GCC.SEGMENT3 AS GL_ACCOUNT_NUMBER ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,NULL AS GL_ACCOUNT_NUMBER--,GCC.SEGMENT3 AS GL_ACCOUNT_NUMBER1 ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,NULL AS TERMS_OF_PAYMENT_KEY
	 ,NULL AS CASH_DISCOUNT_IN_DC
	 ,NULL AS PAYMENT_METHOD
	 ,NULL AS PARTNER_BANK_TYPE
	 ,NULL AS INVOICE_REF
	 ,NULL AS BILLING_DOCUMENT
	 ,NULL AS INV_DUE_DATE
	 ,HP.TAX_REFERENCE AS VAT_REG_NO
	 ,NULL AS SALES_DOCUMENT
	 --,CASE WHEN ((NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR ,0))>=0) THEN 'DR' ELSE 'CR' END AS DEBIT_CREDIT
	 ,NULL AS BASELINE_DATE
	 ,GLL.CURRENCY_CODE AS GL_CURRENCY  
	 ,NVL(XAL.ACCOUNTED_DR,0) - NVL(XAL.ACCOUNTED_CR,0) AS GL_AMOUNT
	 ,NULL AS COST_CENTER_CODE--,GCC.SEGMENT2 AS COST_CENTER_CODE ,GL_CODE_COMBINATIONS GCC NOT PRESENT
	 ,HCA.ACCOUNT_NUMBER AS PAYER
	 ,NULL AS PROFIT_CENTER_CODE
	 ,NULL AS WHT_TAX_CODE
	 ,NULL AS PAYMENT_CURRENCY
	 ,NULL AS CUSTOMER_TRX_ID
	 ,XAL.CODE_COMBINATION_ID AS CODE_COMBINATION_ID
	 ,NULL AS TERM_ID
	 ,XAH.LEDGER_ID AS LEDGER_ID
	 ,XAL.PARTY_ID AS PARTY_ID
	 ,XAL.PARTY_SITE_ID AS PARTY_SITE_ID
	 ,NULL AS CUSTOMER_TRX_LINE_ID
	 ,NULL AS SALES_ORDER
	 ,NULL AS SALES_ORDER_LINE
	 ,NULL AS INVENTORY_ITEM_ID
	 
	,NULL AS VENDOR_CODE
	,NULL AS AP_LINE_ASSIGNMENT
	,CASE WHEN ((NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR ,0))>=0) THEN 'DR' ELSE 'CR' END AS IND_DRCR
	,NULL AS BUSINESS_AREA
	,NULL AS TAX_AMOUNT_LC
	,NULL AS TAX_AMOUNT_DC
	,NULL AS PURCHASING_DOC_NO
	,NULL AS PAYMENT_TERM
	,NULL AS DISCOUNT_AMOUNT
	,NULL AS PAYMENT_BLOCK_KEY
	,NULL AS FIXED_PAYMENT_TERMS
	,NULL AS WHT_BASE_AMOUNT
	,NULL AS WHT_AMOUNT_DC
	,NULL AS PAYEE_PAYER_CODE
	,NULL AS PAYMENT_REFERENCE
	,NULL AS EXCHANGE_TYPE
	,NULL AS INVOICE_ID
	,NULL AS LINE_NUMBER_ID
	,NULL AS VENDOR_ID
	,NULL AS VENDOR_SITE_ID
	,NULL AS DIST_CODE_COMBINATION_ID
	,NULL AS SET_OF_BOOKS_ID
	,NULL AS SPGL_TRANSACTION_TYPE
	,NULL AS PO_HEADER_ID
	,NULL AS PO_LINE_ID
	,NULL AS ORG_ID,
	
	NULL AS DOC_LINE_ITEM,
			NULL AS DOCLINE_ACC_TYPE,
			NULL AS GL_CURRENCY_KEY,
			NULL AS TAX_AMOUNT_2,
			NULL AS LC_BASE_AMNT,
			NULL AS INVOICE_BASE_AMOUNT,
			NULL AS WHT_TAXBASE,
			NULL AS VALUE_DATE,
			NULL AS ACCOUNTING_DOC_LINE_ASSIGNMENT,
			NULL AS DOC_LINE_TEXT,
			NULL AS TRADING_PARTNER_CODE,
			NULL AS TRANSACTION_TYPE,
			NULL AS COST_CENTER_DESCRIPTION,
			--NULL AS BILLING_DOC,
			NULL AS SALES_DOCUMENT_NUMBER,
			NULL AS SALES_DOCUMENT_ITEM,
			NULL AS ASSET_SUBNUMBER,
			NULL AS PERSONNEL_NO,
			NULL AS INVOICE_BASELINE_DATE,
			NULL AS CASH_DISCOUNT_AMOUNT,
			NULL AS DISTRBUTN_TAXCODE,
			--NULL AS AMOUNT_LC,
			NULL AS AMOUNT_IN_FC,
			NULL AS TAX_CODE_2,
			NULL AS ADJUSTED_INVOICE_REFERENCE,
			NULL AS ADJUSTED_INVOICE_FISCAL_YEAR,
			NULL AS ADJUSTED_INVOICE_LINE_ITEM,
			NULL AS WITHHOLDING_TAX,
			NULL AS MATERIAL_NUMBER,
			NULL AS PLANT_CODE,
			NULL AS QUANTITY,
			NULL AS BASE_UOM,
			NULL AS PO_ITEM_NO,
			NULL AS PROFIT_CENTER_NAME,
			NULL AS PARTNER_CODE,
			NULL AS CONTRACT_TYPE,
			NULL AS CONTRACT_NUMBER,
			NULL AS PROFIT_SEGMENT,
			NULL AS PARTNER_PROFIT_CENTER,
			NULL AS REFERENCE_KEY1,
			NULL AS REFERENCE_KEY2,
			NULL AS FUNCTIONAL_AREA,
			NULL AS PAYMENT_TERM_DESC,
			NULL AS DISCOUNT_PERCENT1,
			NULL AS DISCOUNT_PERCENT2,
			NULL AS PURCHASING_ORGANIZATION,
			NULL AS JE_HEADER_ID
			--GJH.JE_HEADER_ID AS JE_HEADER_ID
 
	FROM RAW_ORA.GL_JE_HEADERS GJH 
		INNER JOIN  RAW_ORA.GL_JE_LINES  GJL ON GJH.JE_HEADER_ID = GJL.JE_HEADER_ID 
					AND GJL.STATUS = 'P'
		INNER JOIN  RAW_ORA.GL_IMPORT_REFERENCES GIR ON GJL.JE_HEADER_ID = GIR.JE_HEADER_ID 
					AND GJL.JE_LINE_NUM = GIR.JE_LINE_NUM
		INNER JOIN  RAW_ORA.XLA_AE_LINES XAL ON GIR.GL_SL_LINK_ID  = XAL.GL_SL_LINK_ID 
					AND GIR.GL_SL_LINK_TABLE = XAL.GL_SL_LINK_TABLE
		INNER JOIN  RAW_ORA.XLA_AE_HEADERS XAH ON  XAL.APPLICATION_ID = XAH.APPLICATION_ID 
					AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
		INNER JOIN	RAW_ORA.XLA_EVENTS XE ON XAH.APPLICATION_ID = XE.APPLICATION_ID 
					AND XAH.EVENT_ID = XE.EVENT_ID
		INNER JOIN	RAW_ORA.XLA_TRANSACTION_ENTITIES XTE ON  XE.APPLICATION_ID = XTE.APPLICATION_ID 
					AND XTE.APPLICATION_ID = 222
					AND XE.ENTITY_ID = XTE.ENTITY_ID 
					AND XTE.ENTITY_CODE = 'ADJUSTMENTS'
		INNER JOIN  RAW_ORA.AR_ADJUSTMENTS_ALL ACRA ON XTE.SOURCE_ID_INT_1 = ACRA.ADJUSTMENT_ID
		LEFT JOIN   RAW_ORA.RA_CUSTOMER_TRX_ALL RCTA ON RCTA.CUSTOMER_TRX_ID = ACRA.CUSTOMER_TRX_ID
		LEFT JOIN   RAW_ORA.HZ_CUST_ACCOUNTS HCA ON RCTA.BILL_TO_CUSTOMER_ID = HCA.CUST_ACCOUNT_ID
		LEFT JOIN   RAW_ORA.HZ_PARTIES HP ON HCA.PARTY_ID = HP.PARTY_ID
		INNER JOIN RAW_ORA.GL_LEDGERS GLL ON GLL.LEDGER_ID = XAL.LEDGER_ID 
					AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY'
		LEFT JOIN RAW_ORA.AR_LOOKUPS AL ON AL.LOOKUP_CODE = ACRA.ADJUSTMENT_TYPE 
		WHERE GJH.JE_SOURCE = 'Receivables'
	


	
UNION ALL
	
	
	

SELECT 'AP_INVOICE' AS TRX_SRC, 
		NULL AS COMPANY_CODE, --GL_CODE_COMBINATIONS.SEGMENT1 AS COMPANY_CODE,
		NULL AS CUSTOMER_CODE,
        AP_INVOICES_ALL.INVOICE_TYPE_LOOKUP_CODE AS IND_SPGL,
		AP_INVOICE_PAYMENTS_ALL.ACCOUNTING_DATE AS CLEARING_DATE,
        AP_INVOICE_PAYMENTS_ALL.PAYMENT_NUM AS CLEARING_DOC,
		YEAR(XLA_AE_LINES.ACCOUNTING_DATE) AS FISCAL_YEAR,
		AP_INVOICES_ALL.INVOICE_NUM AS DOCUMENT_NUMBER,
		AP_INVOICE_LINES_ALL.ACCOUNTING_DATE AS POSTING_DATE,
		AP_INVOICE_LINES_ALL.ACCOUNTING_DATE AS DOCUMENT_DATE,
        AP_INVOICES_ALL.INVOICE_CURRENCY_CODE AS CURRENCY_KEY,
        AP_INVOICES_ALL.INVOICE_NUM AS REFERENCE_DOCUMENT_NUMBER,
        AP_INVOICES_ALL.INVOICE_TYPE_LOOKUP_CODE AS DOCUMENT_TYPE,
        MONTH(AP_INVOICES_ALL.GL_DATE) AS POSTING_PERIOD,
		XLA_AE_LINES.Accounting_CLASS_CODE AS POSTING_KEY,
		AP_INVOICE_LINES_ALL.TAX_RATE_CODE AS TAX_CODE,
		
		AP_INVOICE_DISTRIBUTIONS_ALL.AMOUNT * NVL(AP_INVOICES_ALL.EXCHANGE_RATE,1) AS AMOUNT_IN_LC,
		AP_INVOICE_DISTRIBUTIONS_ALL.AMOUNT AS AMOUNT_IN_DC,		
		CASE WHEN XLA_AE_LINES.ACCOUNTING_CLASS_CODE LIKE '%TAX%' THEN (AP_INVOICE_DISTRIBUTIONS_ALL.AMOUNT * NVL(AP_INVOICES_ALL.EXCHANGE_RATE,1)) ELSE 0 END AS LC_TAX,
		NULL AS MAIN_ASSET_NUMBER,
		--NULL AS GL_ACCOUNT_NUMBER1, GL_CODE_COMBINATIONS.SEGMENT3 AS GL_ACCOUNT_NUMBER,
		TO_VARCHAR(AP_INVOICE_DISTRIBUTIONS_ALL.DIST_CODE_COMBINATION_ID) AS GL_ACCOUNT_NUMBER,
		NULL AS TERMS_OF_PAYMENT_KEY,  --WILL BE PICKED UP IN CONSUMPTION VIEW
		NULL AS CASH_DISCOUNT_IN_DC,
		AP_CHECKS_ALL.PAYMENT_METHOD_CODE AS PAYMENT_METHOD,
		NULL AS PARTNER_BANK_TYPE,
		AP_INVOICES_ALL.INVOICE_NUM AS INVOICE_REF,
		NULL AS BILLING_DOCUMENT,
		AP_INVOICES_ALL.TERMS_DATE AS INV_DUE_DATE,
		AP_SUPPLIER_SITES_ALL.VAT_REGISTRATION_NUM AS VAT_REG_NO,
		NULL AS SALES_DOCUMENT,
		--NULL AS DEBIT_CREDIT,
		NULL AS BASELINE_DATE,
		GL_LEDGERS.CURRENCY_CODE AS GL_CURRENCY,
		(NVL(XLA_AE_LINES.ENTERED_DR,0) - NVL(XLA_AE_LINES.ENTERED_CR,0)) AS GL_AMOUNT,
        NULL AS COST_CENTER_CODE, --GL_CODE_COMBINATIONS.SEGMENT2 AS COST_CENTER_CODE,
		NULL AS PAYER,
		NULL AS PROFIT_CENTER_CODE, --GL_CODE_COMBINATIONS.SEGMENT1 AS PROFIT_CENTER_CODE,
		AP_AWT_TAX_RATES_ALL.TAX_NAME AS WHT_TAX_CODE,
		AP_INVOICES_ALL.INVOICE_CURRENCY_CODE AS PAYMENT_CURRENCY,
		NULL AS CUSTOMER_TRX_ID,
		XLA_AE_LINES.CODE_COMBINATION_ID AS CODE_COMBINATION_ID,
		AP_INVOICES_ALL.TERMS_ID AS TERM_ID,
		XLA_AE_LINES.LEDGER_ID AS LEDGER_ID,
		XLA_AE_LINES.PARTY_ID AS PARTY_ID,
		XLA_AE_LINES.PARTY_SITE_ID AS PARTY_SITE_ID,
        NULL AS CUSTOMER_TRX_LINE_ID,
		NULL AS SALES_ORDER,
		NULL AS SALES_ORDER_LINE,
		AP_INVOICE_LINES_ALL.INVENTORY_ITEM_ID AS INVENTORY_ITEM_ID,
		
		AP_SUPPLIERS.SEGMENT1 AS VENDOR_CODE,
        NULL AS AP_LINE_ASSIGNMENT,
        CASE WHEN ((NVL(XLA_AE_LINES.ACCOUNTED_DR,0)-NVL(XLA_AE_LINES.ACCOUNTED_CR ,0))>=0)THEN 'DR' ELSE 'CR' END AS IND_DRCR,
        NULL AS BUSINESS_AREA, --correct
        CASE WHEN AP_INVOICE_DISTRIBUTIONS_ALL.LINE_TYPE_LOOKUP_CODE = 'TAX' THEN AP_INVOICE_DISTRIBUTIONS_ALL.AMOUNT END * AP_INVOICES_ALL.EXCHANGE_RATE AS TAX_AMOUNT_LC,
        CASE WHEN AP_INVOICE_DISTRIBUTIONS_ALL.LINE_TYPE_LOOKUP_CODE = 'TAX' THEN AP_INVOICE_DISTRIBUTIONS_ALL.AMOUNT END AS TAX_AMOUNT_DC,
        PO_HEADERS_ALL.SEGMENT1 AS PURCHASING_DOC_NO,                 
        AP_TERMS_TL.NAME AS PAYMENT_TERM,
        CASE WHEN XLA_AE_LINES.ACCOUNTING_CLASS_CODE = 'DISCOUNT' AND XLA_AE_LINES.APPLICATION_ID = '200' THEN (NVL(XLA_AE_LINES.ENTERED_DR,0) - NVL(XLA_AE_LINES.ENTERED_CR,0)) ELSE NULL END AS DISCOUNT_AMOUNT,
        AP_SUPPLIERS.HOLD_ALL_PAYMENTS_FLAG AS PAYMENT_BLOCK_KEY,
        NULL AS FIXED_PAYMENT_TERMS, --correct
        AP_INVOICE_DISTRIBUTIONS_ALL.AWT_GROSS_AMOUNT AS WHT_BASE_AMOUNT,
        CASE WHEN AP_INVOICE_LINES_ALL.LINE_TYPE_LOOKUP_CODE = 'AWT' THEN AP_INVOICE_LINES_ALL.AMOUNT END AS WHT_AMOUNT_DC,
        NULL AS PAYEE_PAYER_CODE, --correct
        AP_INVOICE_PAYMENTS_ALL.PAYMENT_NUM AS PAYMENT_REFERENCE,
        AP_INVOICES_ALL.EXCHANGE_RATE_TYPE AS EXCHANGE_TYPE,
        AP_INVOICE_LINES_ALL.INVOICE_ID AS INVOICE_ID,
        AP_INVOICE_LINES_ALL.LINE_NUMBER AS LINE_NUMBER_ID,
        AP_INVOICES_ALL.VENDOR_ID AS VENDOR_ID,
        AP_INVOICES_ALL.VENDOR_SITE_ID AS VENDOR_SITE_ID,
        AP_INVOICE_DISTRIBUTIONS_ALL.DIST_CODE_COMBINATION_ID AS DIST_CODE_COMBINATION_ID,
        AP_INVOICES_ALL.SET_OF_BOOKS_ID AS SET_OF_BOOKS_ID,
        CASE WHEN AP_INVOICES_ALL.INVOICE_TYPE_LOOKUP_CODE = 'PREPAYMENT' THEN 'Prepayment' ELSE NULL END AS SPGL_TRANSACTION_TYPE,
        AP_INVOICE_LINES_ALL.PO_HEADER_ID AS PO_HEADER_ID,
        AP_INVOICE_LINES_ALL.PO_LINE_ID AS PO_LINE_ID,
		AP_INVOICE_LINES_ALL.ORG_ID AS ORG_ID,
		
		NULL AS DOC_LINE_ITEM,
			NULL AS DOCLINE_ACC_TYPE,
			GL_LEDGERS.CURRENCY_CODE AS GL_CURRENCY_KEY,
			NULL AS TAX_AMOUNT_2,
			NULL AS LC_BASE_AMNT,
			NULL AS INVOICE_BASE_AMOUNT,
			NULL AS WHT_TAXBASE,
			NULL AS VALUE_DATE,
			NULL AS ACCOUNTING_DOC_LINE_ASSIGNMENT,
			NULL AS DOC_LINE_TEXT,
			NULL AS TRADING_PARTNER_CODE,
			NULL AS TRANSACTION_TYPE,
			NULL AS COST_CENTER_DESCRIPTION,
			--NULL AS BILLING_DOC,
			NULL AS SALES_DOCUMENT_NUMBER,
			NULL AS SALES_DOCUMENT_ITEM,
			NULL AS ASSET_SUBNUMBER,
			NULL AS PERSONNEL_NO,
			NULL AS INVOICE_BASELINE_DATE,
			NULL AS CASH_DISCOUNT_AMOUNT,
			NULL AS DISTRBUTN_TAXCODE,
			--NULL AS AMOUNT_LC,
			NULL AS AMOUNT_IN_FC,
			NULL AS TAX_CODE_2,
			NULL AS ADJUSTED_INVOICE_REFERENCE,
			NULL AS ADJUSTED_INVOICE_FISCAL_YEAR,
			NULL AS ADJUSTED_INVOICE_LINE_ITEM,
			NULL AS WITHHOLDING_TAX,
			NULL AS MATERIAL_NUMBER,
			NULL AS PLANT_CODE,
			NULL AS QUANTITY,
			NULL AS BASE_UOM,
			NULL AS PO_ITEM_NO,
			NULL AS PROFIT_CENTER_NAME,
			NULL AS PARTNER_CODE,
			NULL AS CONTRACT_TYPE,
			NULL AS CONTRACT_NUMBER,
			NULL AS PROFIT_SEGMENT,
			NULL AS PARTNER_PROFIT_CENTER,
			NULL AS REFERENCE_KEY1,
			NULL AS REFERENCE_KEY2,
			NULL AS FUNCTIONAL_AREA,
			NULL AS PAYMENT_TERM_DESC,
			NULL AS DISCOUNT_PERCENT1,
			NULL AS DISCOUNT_PERCENT2,
			NULL AS PURCHASING_ORGANIZATION,
			NULL AS JE_HEADER_ID
			--GL_JE_LINES.JE_HEADER_ID AS JE_HEADER_ID
		
--FROM (SELECT * 
FROM RAW_ORA.GL_JE_LINES --WHERE JE_HEADER_ID =  '3645049.0') GL_JE_LINES
		INNER JOIN RAW_ORA.GL_JE_HEADERS ON GL_JE_LINES.JE_HEADER_ID = GL_JE_HEADERS.JE_HEADER_ID AND GL_JE_HEADERS.JE_SOURCE = 'Payables'
		INNER JOIN RAW_ORA.GL_JE_BATCHES ON GL_JE_BATCHES.JE_BATCH_ID = GL_JE_HEADERS.JE_BATCH_ID
		INNER JOIN RAW_ORA.GL_IMPORT_REFERENCES ON GL_IMPORT_REFERENCES.je_batch_id = GL_JE_BATCHES.je_batch_id
		AND GL_JE_LINES.JE_HEADER_ID = GL_IMPORT_REFERENCES.JE_HEADER_ID AND GL_JE_LINES.JE_LINE_NUM = GL_IMPORT_REFERENCES.JE_LINE_NUM
		inner join RAW_ORA.gl_ledgers on gl_ledgers.LEDGER_ID = GL_JE_LINES.LEDGER_ID AND GL_LEDGERS.LEDGER_CATEGORY_CODE = 'PRIMARY'
		INNER JOIN RAW_ORA.xla_ae_lines ON gl_import_references.gl_sl_link_id = xla_ae_lines.gl_sl_link_id  AND gl_import_references.GL_SL_LINK_TABLE = 'APECL'
		INNER JOIN RAW_ORA.xla_ae_headers on xla_ae_lines.ae_header_id = xla_ae_headers.ae_header_id
			AND xla_ae_headers.ledger_id = xla_ae_lines.ledger_id
		INNER JOIN RAW_ORA.xla_events on xla_ae_headers.event_id = xla_events.event_id
		INNER JOIN RAW_ORA.XLA_TRANSACTION_ENTITIES ON xla_events.APPLICATION_ID = XLA_TRANSACTION_ENTITIES.APPLICATION_ID
		    AND xla_events.ENTITY_ID = XLA_TRANSACTION_ENTITIES.ENTITY_ID
			AND XLA_TRANSACTION_ENTITIES.APPLICATION_ID = 200
			AND XLA_TRANSACTION_ENTITIES.ENTITY_CODE = 'AP_INVOICES'
		INNER JOIN RAW_ORA.xla_distribution_links ON xla_distribution_links.ae_header_id = xla_ae_lines.ae_header_id
			AND xla_distribution_links.ae_line_num = xla_ae_lines.ae_line_num  AND  xla_distribution_links.ae_line_num =  xla_distribution_links.TEMP_LINE_NUM
		INNER JOIN  RAW_ORA.ap_invoice_distributions_all  on xla_events.event_id = ap_invoice_distributions_all.accounting_event_id
			AND XLA_TRANSACTION_ENTITIES.SOURCE_ID_INT_1 = ap_invoice_distributions_all.INVOICE_ID				
			AND xla_distribution_links.source_distribution_id_num_1 = ap_invoice_distributions_all.invoice_distribution_id
		INNER JOIN RAW_ORA.ap_invoice_lines_all ON ap_invoice_distributions_all.invoice_id = ap_invoice_lines_all.invoice_id
			AND ap_invoice_distributions_all.invoice_line_number = ap_invoice_lines_all.line_number
		INNER JOIN RAW_ORA.ap_invoices_all ON ap_invoice_distributions_all.invoice_id = ap_invoices_all.invoice_id
--		INNER JOIN RAW_ORA.gl_code_combinations ON xla_ae_lines.code_combination_id = gl_code_combinations.code_combination_id
--		INNER JOIN RAW_ORA.xla_distribution_links ON xla_distribution_links.ae_header_id = xla_ae_headers.ae_header_id
--			AND xla_distribution_links.ae_line_num = xla_ae_lines.ae_line_num
--			AND xla_distribution_links.source_distribution_id_num_1 = ap_invoice_distributions_all.invoice_distribution_id
		INNER JOIN RAW_ORA.ap_suppliers ON ap_suppliers.vendor_id = ap_invoices_all.vendor_id
		INNER JOIN RAW_ORA.ap_supplier_sites_all ON ap_supplier_sites_all.vendor_id = ap_invoices_all.vendor_id
			AND ap_supplier_sites_all.vendor_site_id = ap_invoices_all.vendor_site_id
		LEFT JOIN RAW_ORA.po_headers_all ON ap_invoice_lines_all.po_header_id = po_headers_all.po_header_id
		LEFT JOIN RAW_ORA.ap_terms_tl ON ap_invoices_all.terms_id = ap_terms_tl.term_id
		LEFT JOIN RAW_ORA.mtl_system_items_b ON ap_invoice_lines_all.inventory_item_id = mtl_system_items_b.inventory_item_id
			AND ap_invoice_lines_all.org_id = mtl_system_items_b.organization_id
		LEFT JOIN RAW_ORA.rcv_shipment_lines ON ap_invoice_lines_all.rcv_shipment_line_id = rcv_shipment_lines.shipment_line_id
		LEFT JOIN RAW_ORA.ap_tax_codes_all ON ap_invoice_distributions_all.tax_code_id = ap_tax_codes_all.tax_id
		left join RAW_ORA.ap_invoice_payments_all ON ap_invoice_payments_all.invoice_id = ap_invoices_all.invoice_id
		LEFT JOIN RAW_ORA.ap_checks_all ON  ap_checks_all.check_id = ap_invoice_payments_all.check_id
		left join RAW_ORA.ap_awt_tax_rates_all on ap_awt_tax_rates_all.tax_rate_id = ap_invoice_distributions_all.AWT_TAX_RATE_ID AND ap_awt_tax_rates_all.ORG_ID = AP_INVOICE_LINES_ALL.ORG_ID
		WHERE     1=1
			and xla_distribution_links.ACCOUNTING_LINE_CODE not like '%ENC'
--			 AND XLA_AE_LINES.ACCOUNTING_CLASS_CODE <> 'ITEM EXPENSE'
--			 AND  xla_distribution_links.ACCOUNTING_LINE_CODE <> 'AP_ITEM_EXPENSE_INV'


UNION ALL


SELECT 'AP_PAYMENTS' AS TRX_SRC  ,
		NULL AS COMPANY_CODE,
		NULL AS CUSTOMER_CODE,
		NULL AS IND_SPGL,--AP_INVOICES_ALL.INVOICE_TYPE_LOOKUP_CODE AS IND_SPGL,
		NULL AS CLEARING_DATE,--AP_INVOICE_PAYMENTS_ALL.ACCOUNTING_DATE AS CLEARING_DATE,
		NULL AS CLEARING_DOC,--AP_INVOICE_PAYMENTS_ALL.PAYMENT_NUM AS CLEARING_DOC,
		YEAR(XLA_AE_LINES.ACCOUNTING_DATE) AS FISCAL_YEAR,
		NULL AS DOCUMENT_NUMBER,--AP_INVOICES_ALL.INVOICE_NUM AS DOCUMENT_NUMBER,
		NULL AS POSTING_DATE,--AP_INVOICE_PAYMENTS_ALL.ACCOUNTING_DATE AS POSTING_DATE,
		NULL AS DOCUMENT_DATE,--AP_INVOICE_PAYMENTS_ALL.ACCOUNTING_DATE AS DOCUMENT_DATE,
        NULL AS CURRENCY_KEY,--AP_INVOICES_ALL.INVOICE_CURRENCY_CODE AS CURRENCY_KEY,
        NULL AS REFERENCE_DOCUMENT_NUMBER,--AP_INVOICES_ALL.INVOICE_NUM AS REFERENCE_DOCUMENT_NUMBER,
        NULL AS DOCUMENT_TYPE,--AP_INVOICES_ALL.INVOICE_TYPE_LOOKUP_CODE AS DOCUMENT_TYPE,
        NULL AS POSTING_PERIOD,--MONTH(AP_INVOICES_ALL.GL_DATE) AS POSTING_PERIOD,
		XLA_AE_LINES.Accounting_CLASS_CODE AS POSTING_KEY,
        NULL AS TAX_CODE,
		NULL AS AMOUNT_IN_LC,
		NULL AS AMOUNT_IN_DC,
		NULL AS LC_TAX,
		NULL AS MAIN_ASSET_NUMBER,
		--NULL AS GL_ACCOUNT_NUMBER1,
		NULL AS GL_ACCOUNT_NUMBER,
		NULL AS TERMS_OF_PAYMENT_KEY,
		NULL AS CASH_DISCOUNT_IN_DC,
		AP_CHECKS_ALL.PAYMENT_METHOD_CODE AS PAYMENT_METHOD,
		NULL AS PARTNER_BANK_TYPE,
		NULL AS INVOICE_REF,
		NULL AS BILLING_DOCUMENT,
		NULL AS INV_DUE_DATE,
		NULL AS VAT_REG_NO,
		NULL AS SALES_DOCUMENT,
		--NULL AS DEBIT_CREDIT, 
		NULL AS BASELINE_DATE,
		NULL AS GL_CURRENCY,
		NULL AS GL_AMOUNT,
		NULL AS COST_CENTER_CODE,
		NULL AS PAYER,
		NULL AS PROFIT_CENTER_CODE,
		NULL AS WHT_TAX_CODE,
		NULL AS PAYMENT_CURRENCY,
		NULL AS CUSTOMER_TRX_ID,
		XLA_AE_LINES.CODE_COMBINATION_ID AS CODE_COMBINATION_ID,
		NULL AS TERM_ID,--AP_INVOICES_ALL.SET_OF_BOOKS_ID AS TERM_ID,
		XLA_AE_LINES.LEDGER_ID AS LEDGER_ID,
		NULL AS PARTY_ID,
		NULL AS PARTY_SITE_ID,
		NULL AS CUSTOMER_TRX_LINE_ID,
		NULL AS SALES_ORDER,
		NULL AS SALES_ORDER_LINE,
		NULL AS INVENTORY_ITEM_ID,
		
		NULL AS VENDOR_CODE,
        NULL AS AP_LINE_ASSIGNMENT,
        CASE WHEN ((NVL(XLA_AE_LINES.ACCOUNTED_DR,0)-NVL(XLA_AE_LINES.ACCOUNTED_CR ,0))>=0)THEN 'DR' ELSE 'CR' END AS IND_DRCR,
        NULL AS BUSINESS_AREA, --correct
		NULL AS TAX_AMOUNT_LC,
		NULL AS TAX_AMOUNT_DC,
		NULL AS PURCHASING_DOC_NO,
		NULL AS PAYMENT_TERM,
        CASE WHEN XLA_AE_LINES.ACCOUNTING_CLASS_CODE = 'DISCOUNT' AND XLA_AE_LINES.APPLICATION_ID = '200' THEN (NVL(XLA_AE_LINES.ENTERED_DR,0) - NVL(XLA_AE_LINES.ENTERED_CR,0)) ELSE NULL END AS DISCOUNT_AMOUNT,
		NULL AS PAYMENT_BLOCK_KEY,                           
		NULL AS FIXED_PAYMENT_TERMS, --correct
		NULL AS WHT_BASE_AMOUNT,
		NULL AS WHT_AMOUNT_DC,
        NULL AS PAYEE_PAYER_CODE, --correct
        NULL AS PAYMENT_REFERENCE,--AP_INVOICE_PAYMENTS_ALL.PAYMENT_NUM AS PAYMENT_REFERENCE,
        NULL AS EXCHANGE_TYPE,--AP_INVOICES_ALL.EXCHANGE_RATE_TYPE AS EXCHANGE_TYPE,
        NULL AS INVOICE_ID,--AP_INVOICES_ALL.INVOICE_ID AS INVOICE_ID,
		NULL AS LINE_NUMBER_ID,
        NULL AS VENDOR_ID,--AP_INVOICES_ALL.VENDOR_ID AS VENDOR_ID,
        NULL AS VENDOR_SITE_ID,--AP_INVOICES_ALL.VENDOR_SITE_ID AS VENDOR_SITE_ID,
		NULL AS DIST_CODE_COMBINATION_ID,
		NULL AS SET_OF_BOOKS_ID,
        NULL AS SPGL_TRANSACTION_TYPE,--CASE WHEN AP_INVOICES_ALL.INVOICE_TYPE_LOOKUP_CODE = 'PREPAYMENT' THEN 'Prepayment' ELSE NULL END AS SPGL_TRANSACTION_TYPE,
		NULL AS PO_HEADER_ID,
		NULL AS PO_LINE_ID,
		NULL AS ORG_ID,
		
		NULL AS DOC_LINE_ITEM,
			NULL AS DOCLINE_ACC_TYPE,
			NULL AS GL_CURRENCY_KEY,
			NULL AS TAX_AMOUNT_2,
			NULL AS LC_BASE_AMNT,
			NULL AS INVOICE_BASE_AMOUNT,
			NULL AS WHT_TAXBASE,
			NULL AS VALUE_DATE,
			NULL AS ACCOUNTING_DOC_LINE_ASSIGNMENT,
			NULL AS DOC_LINE_TEXT,
			NULL AS TRADING_PARTNER_CODE,
			NULL AS TRANSACTION_TYPE,
			NULL AS COST_CENTER_DESCRIPTION,
			--NULL AS BILLING_DOC,
			NULL AS SALES_DOCUMENT_NUMBER,
			NULL AS SALES_DOCUMENT_ITEM,
			NULL AS ASSET_SUBNUMBER,
			NULL AS PERSONNEL_NO,
			NULL AS INVOICE_BASELINE_DATE,
			NULL AS CASH_DISCOUNT_AMOUNT,
			NULL AS DISTRBUTN_TAXCODE,
			--NULL AS AMOUNT_LC,
			NULL AS AMOUNT_IN_FC,
			NULL AS TAX_CODE_2,
			NULL AS ADJUSTED_INVOICE_REFERENCE,
			NULL AS ADJUSTED_INVOICE_FISCAL_YEAR,
			NULL AS ADJUSTED_INVOICE_LINE_ITEM,
			NULL AS WITHHOLDING_TAX,
			NULL AS MATERIAL_NUMBER,
			NULL AS PLANT_CODE,
			NULL AS QUANTITY,
			NULL AS BASE_UOM,
			NULL AS PO_ITEM_NO,
			NULL AS PROFIT_CENTER_NAME,
			NULL AS PARTNER_CODE,
			NULL AS CONTRACT_TYPE,
			NULL AS CONTRACT_NUMBER,
			NULL AS PROFIT_SEGMENT,
			NULL AS PARTNER_PROFIT_CENTER,
			NULL AS REFERENCE_KEY1,
			NULL AS REFERENCE_KEY2,
			NULL AS FUNCTIONAL_AREA,
			NULL AS PAYMENT_TERM_DESC,
			NULL AS DISCOUNT_PERCENT1,
			NULL AS DISCOUNT_PERCENT2,
			NULL AS PURCHASING_ORGANIZATION,
			NULL AS JE_HEADER_ID
			--GL_JE_LINES.JE_HEADER_ID AS JE_HEADER_ID
		
						  
						   
--	FROM (SELECT * 
FROM RAW_ORA.GL_JE_LINES --WHERE JE_HEADER_ID =  '3645049.0') GL_JE_LINES
		INNER JOIN RAW_ORA.GL_JE_HEADERS ON GL_JE_LINES.JE_HEADER_ID = GL_JE_HEADERS.JE_HEADER_ID
			AND GL_JE_HEADERS.JE_SOURCE = 'Payables' AND JE_CATEGORY = 'Payments'
		INNER JOIN RAW_ORA.GL_JE_BATCHES ON GL_JE_BATCHES.JE_BATCH_ID = GL_JE_HEADERS.JE_BATCH_ID
		INNER JOIN RAW_ORA.GL_IMPORT_REFERENCES ON GL_JE_LINES.JE_HEADER_ID = GL_IMPORT_REFERENCES.JE_HEADER_ID
			AND GL_JE_LINES.JE_LINE_NUM = GL_IMPORT_REFERENCES.JE_LINE_NUM
		INNER JOIN RAW_ORA.XLA_AE_LINES ON GL_IMPORT_REFERENCES.GL_SL_LINK_ID = XLA_AE_LINES.GL_SL_LINK_ID
		INNER JOIN RAW_ORA.XLA_AE_HEADERS ON XLA_AE_LINES.AE_HEADER_ID = XLA_AE_HEADERS.AE_HEADER_ID
			AND XLA_AE_HEADERS.LEDGER_ID = XLA_AE_LINES.LEDGER_ID
					INNER JOIN RAW_ORA.XLA_EVENTS ON XLA_AE_HEADERS.EVENT_ID = XLA_EVENTS.EVENT_ID
		INNER JOIN RAW_ORA.XLA_TRANSACTION_ENTITIES ON XLA_EVENTS.APPLICATION_ID = XLA_TRANSACTION_ENTITIES.APPLICATION_ID
			AND XLA_EVENTS.ENTITY_ID = XLA_TRANSACTION_ENTITIES.ENTITY_ID
		    AND XLA_TRANSACTION_ENTITIES.APPLICATION_ID = 200
		    AND XLA_TRANSACTION_ENTITIES.ENTITY_CODE = 'AP_PAYMENTS'
		LEFT JOIN RAW_ORA.AP_CHECKS_ALL ON AP_CHECKS_ALL.CHECK_ID = XLA_TRANSACTION_ENTITIES.SOURCE_ID_INT_1
		
		LEFT JOIN RAW_ORA.AP_INVOICE_PAYMENTS_ALL ON AP_INVOICE_PAYMENTS_ALL.CHECK_ID = XLA_AE_LINES.SOURCE_ID 
			AND XLA_AE_LINES.SOURCE_TABLE = 'AP_INVOICE_PAYMENTS'
		LEFT JOIN RAW_ORA.AP_INVOICES_ALL ON AP_INVOICES_ALL.INVOICE_ID = AP_INVOICE_PAYMENTS_ALL.INVOICE_ID
 

		
		
UNION ALL
		

		
		
SELECT 
			'MISC_AR_AP' AS TRX_SRC,
			NULL AS COMPANY_CODE,
			NULL AS CUSTOMER_CODE, 
			NULL AS IND_SPGL,
			NULL AS CLEARING_DATE,
			NULL AS CLEARING_DOC,
			YEAR(XAL.ACCOUNTING_DATE) AS FISCAL_YEAR,
			TO_VARCHAR(GJH.JE_HEADER_ID) AS DOCUMENT_NUMBER,
			NULL AS POSTING_DATE,
			NULL AS DOCUMENT_DATE,
			NULL AS CURRENCY_KEY,
            NULL AS REFERENCE_DOCUMENT_NUMBER,
			NULL AS DOCUMENT_TYPE,
            NULL AS POSTING_PERIOD,
			XAL.Accounting_CLASS_CODE AS POSTING_KEY,
            NULL AS TAX_CODE,                       
            NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR,0) AS AMOUNT_IN_LC,
			NVL(XAL.ENTERED_DR,0)-NVL(XAL.ENTERED_CR,0) AS AMOUNT_IN_DC,
            NULL AS LC_TAX,	
            NULL AS MAIN_ASSET_NUMBER,			
			--NULL AS GL_ACCOUNT_NUMBER1,
			NULL AS GL_ACCOUNT_NUMBER,
			NULL AS TERMS_OF_PAYMENT_KEY,
			NULL AS CASH_DISCOUNT_IN_DC,
			NULL AS PAYMENT_METHOD,
			NULL AS PARTNER_BANK_TYPE,
			NULL AS INVOICE_REF,
			NULL AS BILLING_DOCUMENT,
			NULL AS INV_DUE_DATE,
			NULL AS VAT_REG_NO,                
			NULL AS SALES_DOCUMENT,
			--NULL AS DEBIT_CREDIT,
			NULL AS BASELINE_DATE,
			NULL AS GL_CURRENCY,
			NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR,0) AS GL_AMOUNT,
			NULL AS COST_CENTER_CODE,
			NULL AS PAYER,
			NULL AS PROFIT_CENTER_CODE,
			NULL AS WHT_TAX_CODE,          
			NULL AS PAYMENT_CURRENCY,
			NULL AS CUSTOMER_TRX_ID,
		    XAL.CODE_COMBINATION_ID AS CODE_COMBINATION_ID,
		    NULL AS TERM_ID,
		    GJL.LEDGER_ID AS LEDGER_ID,
		    NULL AS PARTY_ID,
		    NULL AS PARTY_SITE_ID,
		    NULL AS CUSTOMER_TRX_LINE_ID,
		    NULL AS SALES_ORDER,
		    NULL AS SALES_ORDER_LINE,
		    NULL AS INVENTORY_ITEM_ID,    
			NULL AS VENDOR_CODE,                
			NULL AS AP_LINE_ASSIGNMENT,
			CASE WHEN ((NVL(XAL.ACCOUNTED_DR,0)-NVL(XAL.ACCOUNTED_CR ,0))>=0)THEN 'DR' ELSE 'CR' END AS IND_DRCR,
			NULL AS BUSINESS_AREA,
		    NULL AS TAX_AMOUNT_LC,
		    NULL AS TAX_AMOUNT_DC,
		    NULL AS PURCHASING_DOC_NO,               
		    NULL AS PAYMENT_TERM,                  
		    NULL AS DISCOUNT_AMOUNT,
		    NULL AS PAYMENT_BLOCK_KEY,
		    NULL AS FIXED_PAYMENT_TERMS,
		    NULL AS WHT_BASE_AMOUNT,
		    NULL AS WHT_AMOUNT_DC,
		    NULL AS PAYEE_PAYER_CODE,
		    NULL AS PAYMENT_REFERENCE,
		    NULL AS EXCHANGE_TYPE,
		    NULL AS INVOICE_ID,
		    NULL AS LINE_NUMBER_ID,
		    NULL AS VENDOR_ID,
		    NULL AS VENDOR_SITE_ID,
		    NULL AS DIST_CODE_COMBINATION_ID,
		    NULL AS SET_OF_BOOKS_ID,
		    NULL AS SPGL_TRANSACTION_TYPE,
		    NULL AS PO_HEADER_ID,
		    NULL AS PO_LINE_ID,
		    GJB.ORG_ID AS ORG_ID,                         
			XAL.AE_LINE_NUM AS DOC_LINE_ITEM,
			NULL AS DOCLINE_ACC_TYPE,
			GLL.CURRENCY_CODE AS GL_CURRENCY_KEY,
			NULL AS TAX_AMOUNT_2,
			NULL AS LC_BASE_AMNT,													
			NULL AS INVOICE_BASE_AMOUNT,		
			NULL AS WHT_TAXBASE,			
			NULL AS VALUE_DATE, 
			NULL AS ACCOUNTING_DOC_LINE_ASSIGNMENT,	
			NULL AS DOC_LINE_TEXT,	
			NULL AS TRADING_PARTNER_CODE,
			NULL AS TRANSACTION_TYPE, 	
			NULL AS COST_CENTER_DESCRIPTION,		
			--NULL AS BILLING_DOC, 
			NULL AS SALES_DOCUMENT_NUMBER,
			NULL AS SALES_DOCUMENT_ITEM, 
			NULL AS ASSET_SUBNUMBER,
			NULL AS PERSONNEL_NO, 		
			NULL AS INVOICE_BASELINE_DATE,            
			NULL AS CASH_DISCOUNT_AMOUNT, 
			NULL AS DISTRBUTN_TAXCODE,  
			--NULL AS AMOUNT_LC,
			NULL AS AMOUNT_IN_FC, 
			NULL AS TAX_CODE_2,
			NULL AS ADJUSTED_INVOICE_REFERENCE,          
			YEAR(XAL.ACCOUNTING_DATE) AS ADJUSTED_INVOICE_FISCAL_YEAR,
			NULL AS ADJUSTED_INVOICE_LINE_ITEM, 
			NULL AS WITHHOLDING_TAX, 
			NULL AS MATERIAL_NUMBER, --TO BE DERIVED IN RPT
			NULL AS PLANT_CODE,         
			NULL AS QUANTITY,          
			NULL AS BASE_UOM,  
			NULL AS PO_ITEM_NO,  --TO BE DERIVED IN RPT
			NULL AS PROFIT_CENTER_NAME, 
			NULL AS PARTNER_CODE,  
			NULL AS CONTRACT_TYPE,  
			NULL AS CONTRACT_NUMBER, 
			NULL AS PROFIT_SEGMENT,  
			NULL AS PARTNER_PROFIT_CENTER,
			NULL AS REFERENCE_KEY1,
			NULL AS REFERENCE_KEY2,
			NULL AS FUNCTIONAL_AREA,
			NULL AS PAYMENT_TERM_DESC,
			NULL AS DISCOUNT_PERCENT1,
			NULL AS DISCOUNT_PERCENT2,
			NULL AS PURCHASING_ORGANIZATION,
			GJL.JE_HEADER_ID AS JE_HEADER_ID
  FROM  RAW_ORA.GL_JE_LINES GJL
     ,  RAW_ORA.GL_JE_HEADERS GJH
     ,  RAW_ORA.GL_JE_BATCHES GJB
     ,  RAW_ORA.GL_IMPORT_REFERENCES GIR
     ,  RAW_ORA.XLA_AE_LINES XAL
     ,  RAW_ORA.XLA_AE_HEADERS XAH
     ,  RAW_ORA.XLA_EVENTS XE
     ,  RAW_ORA.XLA_TRANSACTION_ENTITIES XTE
     --,  RAW_ORA.GL_CODE_COMBINATIONS GCC
     ,	RAW_ORA.GL_LEDGERS GLL
 WHERE GJB.JE_BATCH_ID = GJH.JE_BATCH_ID
   AND GJL.JE_HEADER_ID = GJH.JE_HEADER_ID
   AND GJL.JE_HEADER_ID = GIR.JE_HEADER_ID
   AND GJL.JE_LINE_NUM = GIR.JE_LINE_NUM
   AND GIR.GL_SL_LINK_TABLE = XAL.GL_SL_LINK_TABLE
   AND GIR.GL_SL_LINK_ID = XAL.GL_SL_LINK_ID
   AND XAL.APPLICATION_ID = XAH.APPLICATION_ID
   AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
   AND GLL.LEDGER_ID = GJL.LEDGER_ID
   AND XAH.APPLICATION_ID = XE.APPLICATION_ID
   AND XAH.EVENT_ID = XE.EVENT_ID
   AND XE.APPLICATION_ID = XTE.APPLICATION_ID
   AND XE.ENTITY_ID = XTE.ENTITY_ID
   AND (XTE.ENTITY_CODE||TO_CHAR(XTE.APPLICATION_ID)) NOT IN ('AP_INVOICES200','AP_PAYMENTS200','TRANSACTIONS222','RECEIPTS222','ADJUSTMENTS222')
   AND GJH.JE_SOURCE IN ('Payables','Receivables')
   --AND XAL.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
   AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY'
   AND XTE.APPLICATION_ID IN('200','222')
   
   
UNION ALL
   

SELECT 
			'Others' AS TRX_SRC,
			NULL AS COMPANY_CODE,
			NULL AS CUSTOMER_CODE,
			NULL AS IND_SPGL,
			NULL AS CLEARING_DATE,
			NULL AS CLEARING_DOC,
			YEAR(GJL.EFFECTIVE_DATE) AS FISCAL_YEAR,
			TO_VARCHAR(GJH.JE_HEADER_ID) AS DOCUMENT_NUMBER,
			NULL AS POSTING_DATE,
			NULL AS DOCUMENT_DATE,
			NULL AS CURRENCY_KEY,
			NULL AS REFERENCE_DOCUMENT_NUMBER,
			NULL AS DOCUMENT_TYPE,
			NULL AS POSTING_PERIOD,
			NULL AS POSTING_KEY,
			NULL AS TAX_CODE,
			NVL(GJL.ACCOUNTED_DR,0)-NVL(GJL.ACCOUNTED_CR,0) AS AMOUNT_IN_LC,
			NVL(GJL.ENTERED_DR,0)-NVL(GJL.ENTERED_CR,0) AS AMOUNT_IN_DC,
			NULL AS LC_TAX,
            NULL AS MAIN_ASSET_NUMBER,			
			--NULL AS GL_ACCOUNT_NUMBER1,
			NULL AS GL_ACCOUNT_NUMBER,
			NULL AS TERMS_OF_PAYMENT_KEY,
			NULL AS CASH_DISCOUNT_IN_DC,
			NULL AS PAYMENT_METHOD,
			NULL AS PARTNER_BANK_TYPE,
			NULL AS INVOICE_REF,
			NULL AS BILLING_DOCUMENT,
			NULL AS INV_DUE_DATE,
			NULL AS VAT_REG_NO,
			NULL AS SALES_DOCUMENT,
			--NULL AS DEBIT_CREDIT,
			NULL AS BASELINE_DATE,
			NULL AS GL_CURRENCY,
			NULL AS GL_AMOUNT,
			NULL AS COST_CENTER_CODE,
			NULL AS PAYER,
			NULL AS PROFIT_CENTER_CODE,
			NULL AS WHT_TAX_CODE,
			NULL AS PAYMENT_CURRENCY,
			NULL AS CUSTOMER_TRX_ID,
		    GJL.CODE_COMBINATION_ID AS CODE_COMBINATION_ID,
		    NULL AS TERM_ID,
		    GJL.LEDGER_ID AS LEDGER_ID,
		    NULL AS PARTY_ID,
		    NULL AS PARTY_SITE_ID,
		    NULL AS CUSTOMER_TRX_LINE_ID,
		    NULL AS SALES_ORDER,
		    NULL AS SALES_ORDER_LINE,
		    NULL AS INVENTORY_ITEM_ID,
			NULL AS VENDOR_CODE,
			NULL AS AP_LINE_ASSIGNMENT,
			CASE WHEN (NVL(GJL.ACCOUNTED_DR,0)-NVL(GJL.ACCOUNTED_CR,0)) <0 Then 'CR'  Else 'DR' End as IND_DRCR,
		    NULL AS BUSINESS_AREA,
		    NULL AS TAX_AMOUNT_LC,
		    NULL AS TAX_AMOUNT_DC,
		    NULL AS PURCHASING_DOC_NO,
		    NULL AS PAYMENT_TERM,
		    NULL AS DISCOUNT_AMOUNT,
		    NULL AS PAYMENT_BLOCK_KEY,
		    NULL AS FIXED_PAYMENT_TERMS,
		    NULL AS WHT_BASE_AMOUNT,
		    NULL AS WHT_AMOUNT_DC,
		    NULL AS PAYEE_PAYER_CODE,
		    NULL AS PAYMENT_REFERENCE,
		    NULL AS EXCHANGE_TYPE,
		    NULL AS INVOICE_ID,
		    NULL AS LINE_NUMBER_ID,
		    NULL AS VENDOR_ID,
		    NULL AS VENDOR_SITE_ID,
		    NULL AS DIST_CODE_COMBINATION_ID,
		    NULL AS SET_OF_BOOKS_ID,
		    NULL AS SPGL_TRANSACTION_TYPE,
		    NULL AS PO_HEADER_ID,
		    NULL AS PO_LINE_ID,
		    GJB.ORG_ID AS ORG_ID,
			GJL.JE_LINE_NUM AS DOC_LINE_ITEM,
			NULL AS DOCLINE_ACC_TYPE,
			GLL.CURRENCY_CODE AS GL_CURRENCY_KEY,
			NULL AS TAX_AMOUNT_2,
			NULL AS LC_BASE_AMNT,													
			NULL AS INVOICE_BASE_AMOUNT,		
			NULL AS WHT_TAXBASE,			
			NULL AS VALUE_DATE, 
			NULL AS ACCOUNTING_DOC_LINE_ASSIGNMENT,	
			NULL AS DOC_LINE_TEXT,	
			NULL AS TRADING_PARTNER_CODE,
			NULL AS TRANSACTION_TYPE, 	
			NULL AS COST_CENTER_DESCRIPTION,		
			--NULL AS BILLING_DOC, 
			NULL AS SALES_DOCUMENT_NUMBER,
			NULL AS SALES_DOCUMENT_ITEM, 
			NULL AS ASSET_SUBNUMBER,
			NULL AS PERSONNEL_NO,
			NULL AS INVOICE_BASELINE_DATE,
			NULL AS CASH_DISCOUNT_AMOUNT, 
			NULL AS DISTRBUTN_TAXCODE,  
			--NULL AS AMOUNT_LC,
			NULL AS AMOUNT_IN_FC, 
			NULL AS TAX_CODE_2,
			NULL AS ADJUSTED_INVOICE_REFERENCE,
			NULL AS ADJUSTED_INVOICE_FISCAL_YEAR,
			NULL AS ADJUSTED_INVOICE_LINE_ITEM, 
			NULL AS WITHHOLDING_TAX, 
			NULL AS MATERIAL_NUMBER, --TO BE DERIVED IN RPT
			NULL AS PLANT_CODE,
			NULL AS QUANTITY,
			NULL AS BASE_UOM,  
			NULL AS PO_ITEM_NO,  --TO BE DERIVED IN RPT
			NULL AS PROFIT_CENTER_NAME, 
			NULL AS PARTNER_CODE,  
			NULL AS CONTRACT_TYPE,  
			NULL AS CONTRACT_NUMBER, 
			NULL AS PROFIT_SEGMENT,  
			NULL AS PARTNER_PROFIT_CENTER,
			NULL AS REFERENCE_KEY1,
			NULL AS REFERENCE_KEY2,
			NULL AS FUNCTIONAL_AREA,
			NULL AS PAYMENT_TERM_DESC,
			NULL AS DISCOUNT_PERCENT1,
			NULL AS DISCOUNT_PERCENT2,
			NULL AS PURCHASING_ORGANIZATION,
			GJL.JE_HEADER_ID AS JE_HEADER_ID
  FROM  RAW_ORA.GL_JE_LINES GJL
     ,  RAW_ORA.GL_JE_HEADERS GJH
     ,  RAW_ORA.GL_JE_BATCHES GJB
     --,  RAW_ORA.GL_CODE_COMBINATIONS GCC
     ,	RAW_ORA.GL_LEDGERS GLL
	 --,	RAW_ORA.XLA_AE_LINES XAL
 WHERE GJB.JE_BATCH_ID = GJH.JE_BATCH_ID
   AND GJL.JE_HEADER_ID = GJH.JE_HEADER_ID
   AND GLL.LEDGER_ID = GJL.LEDGER_ID
   AND GJH.JE_SOURCE NOT IN  ('Payables','Receivables')
   AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY'
   --AND GJL.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
   )Q1;


			SELECT COUNT(*) INTO SOURCE1 FROM RAW_ORA.GL_JE_HEADERS GJH  
		INNER JOIN  RAW_ORA.GL_JE_LINES GJL ON GJH.JE_HEADER_ID = GJL.JE_HEADER_ID
		            AND GJL.STATUS = 'P'
		INNER JOIN  RAW_ORA.GL_IMPORT_REFERENCES GIR ON GJL.JE_HEADER_ID = GIR.JE_HEADER_ID
					AND GJL.JE_LINE_NUM = GIR.JE_LINE_NUM
		INNER JOIN  RAW_ORA.XLA_AE_LINES XAL ON GIR.GL_SL_LINK_ID  = XAL.GL_SL_LINK_ID
					AND GIR.GL_SL_LINK_TABLE = XAL.GL_SL_LINK_TABLE
		INNER JOIN  RAW_ORA.XLA_AE_HEADERS XAH ON  XAL.APPLICATION_ID = XAH.APPLICATION_ID
					AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
		INNER JOIN	RAW_ORA.XLA_EVENTS XE ON XAH.APPLICATION_ID = XE.APPLICATION_ID
					AND XAH.EVENT_ID = XE.EVENT_ID
		INNER JOIN	RAW_ORA.XLA_TRANSACTION_ENTITIES XTE ON  XE.APPLICATION_ID = XTE.APPLICATION_ID
					AND XTE.APPLICATION_ID = 222
					AND XE.ENTITY_ID = XTE.ENTITY_ID
					AND XTE.ENTITY_CODE = 'TRANSACTIONS'
		INNER JOIN  RAW_ORA.XLA_DISTRIBUTION_LINKS XDL ON XAL.AE_HEADER_ID = XDL.AE_HEADER_ID
					AND XAL.AE_LINE_NUM = XDL.AE_LINE_NUM
		INNER JOIN 	RAW_ORA.RA_CUSTOMER_TRX_ALL ACRA ON XTE.SOURCE_ID_INT_1 = ACRA.CUSTOMER_TRX_ID
		INNER JOIN  RAW_ORA.RA_CUST_TRX_LINE_GL_DIST_ALL RGDA ON ACRA.CUSTOMER_TRX_ID = RGDA.CUSTOMER_TRX_ID
					AND XDL.SOURCE_DISTRIBUTION_ID_NUM_1 = RGDA.CUST_TRX_LINE_GL_DIST_ID
					WHERE GJH.JE_SOURCE = 'Receivables'; 
					
			SELECT COUNT(*) INTO SOURCE2 FROM RAW_ORA.GL_JE_HEADERS GJH 
		INNER JOIN  RAW_ORA.GL_JE_LINES GJL ON GJH.JE_HEADER_ID = GJL.JE_HEADER_ID 
					AND GJL.STATUS = 'P'
		INNER JOIN  RAW_ORA.GL_IMPORT_REFERENCES GIR ON GJL.JE_HEADER_ID = GIR.JE_HEADER_ID 
					AND GJL.JE_LINE_NUM = GIR.JE_LINE_NUM
		INNER JOIN  RAW_ORA.XLA_AE_LINES XAL ON GIR.GL_SL_LINK_ID  = XAL.GL_SL_LINK_ID 
					AND GIR.GL_SL_LINK_TABLE = XAL.GL_SL_LINK_TABLE
		INNER JOIN  RAW_ORA.XLA_AE_HEADERS XAH ON  XAL.APPLICATION_ID = XAH.APPLICATION_ID 
					AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
		INNER JOIN	RAW_ORA.XLA_EVENTS XE ON XAH.APPLICATION_ID = XE.APPLICATION_ID 
					AND XAH.EVENT_ID = XE.EVENT_ID
		INNER JOIN	RAW_ORA.XLA_TRANSACTION_ENTITIES XTE ON  XE.APPLICATION_ID = XTE.APPLICATION_ID 
					AND XTE.APPLICATION_ID = 222 
					AND XE.ENTITY_ID = XTE.ENTITY_ID 
					AND XTE.ENTITY_CODE = 'RECEIPTS'
		INNER JOIN 	RAW_ORA.AR_CASH_RECEIPTS_ALL ACRA ON XTE.SOURCE_ID_INT_1 = ACRA.CASH_RECEIPT_ID
		INNER JOIN RAW_ORA.GL_LEDGERS GLL ON GLL.LEDGER_ID = XAL.LEDGER_ID 
					AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY'
					WHERE GJH.JE_SOURCE = 'Receivables';   
					
			SELECT COUNT(*) FROM SOURCE3 RAW_ORA.GL_JE_HEADERS GJH 
		INNER JOIN  RAW_ORA.GL_JE_LINES  GJL ON GJH.JE_HEADER_ID = GJL.JE_HEADER_ID 
					AND GJL.STATUS = 'P'
		INNER JOIN  RAW_ORA.GL_IMPORT_REFERENCES GIR ON GJL.JE_HEADER_ID = GIR.JE_HEADER_ID 
					AND GJL.JE_LINE_NUM = GIR.JE_LINE_NUM
		INNER JOIN  RAW_ORA.XLA_AE_LINES XAL ON GIR.GL_SL_LINK_ID  = XAL.GL_SL_LINK_ID 
					AND GIR.GL_SL_LINK_TABLE = XAL.GL_SL_LINK_TABLE
		INNER JOIN  RAW_ORA.XLA_AE_HEADERS XAH ON  XAL.APPLICATION_ID = XAH.APPLICATION_ID 
					AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
		INNER JOIN	RAW_ORA.XLA_EVENTS XE ON XAH.APPLICATION_ID = XE.APPLICATION_ID 
					AND XAH.EVENT_ID = XE.EVENT_ID
		INNER JOIN	RAW_ORA.XLA_TRANSACTION_ENTITIES XTE ON  XE.APPLICATION_ID = XTE.APPLICATION_ID 
					AND XTE.APPLICATION_ID = 222
					AND XE.ENTITY_ID = XTE.ENTITY_ID 
					AND XTE.ENTITY_CODE = 'ADJUSTMENTS'
		INNER JOIN  RAW_ORA.AR_ADJUSTMENTS_ALL ACRA ON XTE.SOURCE_ID_INT_1 = ACRA.ADJUSTMENT_ID
		INNER JOIN RAW_ORA.GL_LEDGERS GLL ON GLL.LEDGER_ID = XAL.LEDGER_ID 
					AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY'
		WHERE GJH.JE_SOURCE = 'Receivables';
			
		SELECT COUNT(*) INTO SOURCE4 FROM RAW_ORA.GL_JE_LINES --WHERE JE_HEADER_ID =  '3645049.0' GL_JE_LINES
		INNER JOIN RAW_ORA.GL_JE_HEADERS ON GL_JE_LINES.JE_HEADER_ID = GL_JE_HEADERS.JE_HEADER_ID AND GL_JE_HEADERS.JE_SOURCE = 'Payables'
		INNER JOIN RAW_ORA.GL_JE_BATCHES ON GL_JE_BATCHES.JE_BATCH_ID = GL_JE_HEADERS.JE_BATCH_ID
		INNER JOIN RAW_ORA.GL_IMPORT_REFERENCES ON GL_IMPORT_REFERENCES.je_batch_id = GL_JE_BATCHES.je_batch_id
		AND GL_JE_LINES.JE_HEADER_ID = GL_IMPORT_REFERENCES.JE_HEADER_ID AND GL_JE_LINES.JE_LINE_NUM = GL_IMPORT_REFERENCES.JE_LINE_NUM
		inner join RAW_ORA.gl_ledgers on gl_ledgers.LEDGER_ID = GL_JE_LINES.LEDGER_ID AND GL_LEDGERS.LEDGER_CATEGORY_CODE = 'PRIMARY'
		INNER JOIN RAW_ORA.xla_ae_lines ON gl_import_references.gl_sl_link_id = xla_ae_lines.gl_sl_link_id  AND gl_import_references.GL_SL_LINK_TABLE = 'APECL'
		INNER JOIN RAW_ORA.xla_ae_headers on xla_ae_lines.ae_header_id = xla_ae_headers.ae_header_id
			AND xla_ae_headers.ledger_id = xla_ae_lines.ledger_id
		INNER JOIN RAW_ORA.xla_events on xla_ae_headers.event_id = xla_events.event_id
		INNER JOIN RAW_ORA.XLA_TRANSACTION_ENTITIES ON xla_events.APPLICATION_ID = XLA_TRANSACTION_ENTITIES.APPLICATION_ID
		    AND xla_events.ENTITY_ID = XLA_TRANSACTION_ENTITIES.ENTITY_ID
			AND XLA_TRANSACTION_ENTITIES.APPLICATION_ID = 200
			AND XLA_TRANSACTION_ENTITIES.ENTITY_CODE = 'AP_INVOICES'
		INNER JOIN RAW_ORA.xla_distribution_links ON xla_distribution_links.ae_header_id = xla_ae_lines.ae_header_id
			AND xla_distribution_links.ae_line_num = xla_ae_lines.ae_line_num  AND  xla_distribution_links.ae_line_num =  xla_distribution_links.TEMP_LINE_NUM
		INNER JOIN  RAW_ORA.ap_invoice_distributions_all  on xla_events.event_id = ap_invoice_distributions_all.accounting_event_id
			AND XLA_TRANSACTION_ENTITIES.SOURCE_ID_INT_1 = ap_invoice_distributions_all.INVOICE_ID				
			AND xla_distribution_links.source_distribution_id_num_1 = ap_invoice_distributions_all.invoice_distribution_id
		INNER JOIN RAW_ORA.ap_invoice_lines_all ON ap_invoice_distributions_all.invoice_id = ap_invoice_lines_all.invoice_id
			AND ap_invoice_distributions_all.invoice_line_number = ap_invoice_lines_all.line_number
		INNER JOIN RAW_ORA.ap_invoices_all ON ap_invoice_distributions_all.invoice_id = ap_invoices_all.invoice_id
--		INNER JOIN RAW_ORA.gl_code_combinations ON xla_ae_lines.code_combination_id = gl_code_combinations.code_combination_id
--		INNER JOIN RAW_ORA.xla_distribution_links ON xla_distribution_links.ae_header_id = xla_ae_headers.ae_header_id
--			AND xla_distribution_links.ae_line_num = xla_ae_lines.ae_line_num
--			AND xla_distribution_links.source_distribution_id_num_1 = ap_invoice_distributions_all.invoice_distribution_id
		INNER JOIN RAW_ORA.ap_suppliers ON ap_suppliers.vendor_id = ap_invoices_all.vendor_id
		INNER JOIN RAW_ORA.ap_supplier_sites_all ON ap_supplier_sites_all.vendor_id = ap_invoices_all.vendor_id
			AND ap_supplier_sites_all.vendor_site_id = ap_invoices_all.vendor_site_id
			WHERE     1=1
			and xla_distribution_links.ACCOUNTING_LINE_CODE not like '%ENC';
--			 AND XLA_AE_LINES.ACCOUNTING_CLASS_CODE <> 'ITEM EXPENSE'
--			 AND  xla_distribution_links.ACCOUNTING_LINE_CODE <> 'AP_ITEM_EXPENSE_INV';
			
			SELECT COUNT(*) INTO SOURCE5 FROM RAW_ORA.GL_JE_LINES --WHERE JE_HEADER_ID =  '3645049.0' GL_JE_LINES
		INNER JOIN RAW_ORA.GL_JE_HEADERS ON GL_JE_LINES.JE_HEADER_ID = GL_JE_HEADERS.JE_HEADER_ID
			AND GL_JE_HEADERS.JE_SOURCE = 'Payables' AND JE_CATEGORY = 'Payments'
		INNER JOIN RAW_ORA.GL_JE_BATCHES ON GL_JE_BATCHES.JE_BATCH_ID = GL_JE_HEADERS.JE_BATCH_ID
		INNER JOIN RAW_ORA.GL_IMPORT_REFERENCES ON GL_JE_LINES.JE_HEADER_ID = GL_IMPORT_REFERENCES.JE_HEADER_ID
			AND GL_JE_LINES.JE_LINE_NUM = GL_IMPORT_REFERENCES.JE_LINE_NUM
		INNER JOIN RAW_ORA.XLA_AE_LINES ON GL_IMPORT_REFERENCES.GL_SL_LINK_ID = XLA_AE_LINES.GL_SL_LINK_ID
		INNER JOIN RAW_ORA.XLA_AE_HEADERS ON XLA_AE_LINES.AE_HEADER_ID = XLA_AE_HEADERS.AE_HEADER_ID
			AND XLA_AE_HEADERS.LEDGER_ID = XLA_AE_LINES.LEDGER_ID
					INNER JOIN RAW_ORA.XLA_EVENTS ON XLA_AE_HEADERS.EVENT_ID = XLA_EVENTS.EVENT_ID
		INNER JOIN RAW_ORA.XLA_TRANSACTION_ENTITIES ON XLA_EVENTS.APPLICATION_ID = XLA_TRANSACTION_ENTITIES.APPLICATION_ID
			AND XLA_EVENTS.ENTITY_ID = XLA_TRANSACTION_ENTITIES.ENTITY_ID
		    AND XLA_TRANSACTION_ENTITIES.APPLICATION_ID = 200
		    AND XLA_TRANSACTION_ENTITIES.ENTITY_CODE = 'AP_PAYMENTS';
					
			SELECT COUNT(*) INTO SOURCE6 FROM RAW_ORA.GL_JE_LINES GJL
     ,  RAW_ORA.GL_JE_HEADERS GJH
     ,  RAW_ORA.GL_JE_BATCHES GJB
     ,  RAW_ORA.GL_IMPORT_REFERENCES GIR
     ,  RAW_ORA.XLA_AE_LINES XAL
     ,  RAW_ORA.XLA_AE_HEADERS XAH
     ,  RAW_ORA.XLA_EVENTS XE
     ,  RAW_ORA.XLA_TRANSACTION_ENTITIES XTE
     --,  RAW_ORA.GL_CODE_COMBINATIONS GCC
     ,	RAW_ORA.GL_LEDGERS GLL
 WHERE GJB.JE_BATCH_ID = GJH.JE_BATCH_ID
   AND GJL.JE_HEADER_ID = GJH.JE_HEADER_ID
   AND GJL.JE_HEADER_ID = GIR.JE_HEADER_ID
   AND GJL.JE_LINE_NUM = GIR.JE_LINE_NUM
   AND GIR.GL_SL_LINK_TABLE = XAL.GL_SL_LINK_TABLE
   AND GIR.GL_SL_LINK_ID = XAL.GL_SL_LINK_ID
   AND XAL.APPLICATION_ID = XAH.APPLICATION_ID
   AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
   AND GLL.LEDGER_ID = GJL.LEDGER_ID
   AND XAH.APPLICATION_ID = XE.APPLICATION_ID
   AND XAH.EVENT_ID = XE.EVENT_ID
   AND XE.APPLICATION_ID = XTE.APPLICATION_ID
   AND XE.ENTITY_ID = XTE.ENTITY_ID
   AND (XTE.ENTITY_CODE||TO_CHAR(XTE.APPLICATION_ID)) NOT IN ('AP_INVOICES200','AP_PAYMENTS200','TRANSACTIONS222','RECEIPTS222','ADJUSTMENTS222')
   AND GJH.JE_SOURCE IN ('Payables','Receivables')
   --AND XAL.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
   AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY'
   AND XTE.APPLICATION_ID IN('200','222');
		
		SELECT COUNT(*) INTO SOURCE7 FROM  RAW_ORA.GL_JE_LINES GJL
     ,  RAW_ORA.GL_JE_HEADERS GJH
     ,  RAW_ORA.GL_JE_BATCHES GJB
     --,  RAW_ORA.GL_CODE_COMBINATIONS GCC
     ,	RAW_ORA.GL_LEDGERS GLL
	 --,	RAW_ORA.XLA_AE_LINES XAL
 WHERE GJB.JE_BATCH_ID = GJH.JE_BATCH_ID
   AND GJL.JE_HEADER_ID = GJH.JE_HEADER_ID
   AND GLL.LEDGER_ID = GJL.LEDGER_ID
   AND GJH.JE_SOURCE NOT IN  ('Payables','Receivables')
   AND GLL.LEDGER_CATEGORY_CODE = 'PRIMARY';
   --AND GJL.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
	
	SOURCE_ROW_COUNT := SOURCE1+SOURCE2+SOURCE3+SOURCE4+SOURCE5+SOURCE6+SOURCE7;
			
			SELECT COUNT(*) INTO TARGET_ROW_COUNT  FROM ENRICH.FACT_ACCOUNTING_DOCUMENT_LINES WHERE IS_ACTIVE = 1 AND SOURCE_ID = 2;
			OBJECT_END_DATE := CURRENT_TIMESTAMP();
			CALL DEV_DB.LOGGER.SP_AUDIT_LOG(
				:TRIGGER_ID,
				:BATCH_ID,
				'oracle',
				'raw to enrich',
				'fact_accounting_document_lines',
				:SOURCE_ROW_COUNT,
				:TARGET_ROW_COUNT,
				0,
				0,
				CURRENT_TIMESTAMP(),
				NULL,
				0,
				'full',
				'success',
				'select * from fact_accounting_document_lines where is_active = 1 SOURCE_ID = 2',
				:OBJECT_START_DATE,
				:OBJECT_END_DATE,
				NULL,
				CURRENT_TIMESTAMP()
			);
			RETURN 1;
			EXCEPTION WHEN OTHER THEN
			LET error_message :=SQLERRM;
			LET error_code :=SQLCODE;
			CALL DEV_DB.LOGGER.SP_AUDIT_LOG(
				:TRIGGER_ID,
				:BATCH_ID,
				'oracle',
				'raw to enrich',
				'fact_accounting_document_lines',
				null,
				null,
				0,
				0,
				CURRENT_TIMESTAMP(),
				NULL,
				0,
				'full',
				'failed',
				'select * from fact_accounting_document_lines where is_active = 1 SOURCE_ID = 2',
				:OBJECT_START_DATE,
				null,
				NULL,
				CURRENT_TIMESTAMP()
			);
			CALL DEV_DB.LOGGER.SP_ERROR_LOG(
			:TRIGGER_ID,
			:BATCH_ID,
			'oracle',
			'raw to enrich',
			'fact_accounting_document_lines',
			'error occured while inserting data into fact_accounting_document_lines',
			:error_code,
			NULL,
			'sql_error',
			:error_message,
			CURRENT_TIMESTAMP(),
			NULL,
			NULL
			);
			 RETURN OBJECT_CONSTRUCT('Error type', 'Other error',
										'SQLCODE', sqlcode,
										'SQLERRM', sqlerrm,
										'SQLSTATE', sqlstate);
 END;
$$;
